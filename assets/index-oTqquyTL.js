(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(a){if(a.ep)return;a.ep=!0;const n=t(a);fetch(a.href,n)}})();const ue=[{min:0,max:6790,rate:.1,name:"מדרגה ראשונה"},{min:6790,max:9730,rate:.14,name:"מדרגה שנייה"},{min:9730,max:15620,rate:.2,name:"מדרגה שלישית"},{min:15620,max:21709,rate:.31,name:"מדרגה רביעית"},{min:21709,max:45180,rate:.35,name:"מדרגה חמישית"},{min:45180,max:58510,rate:.47,name:"מדרגה שישית"},{min:58510,max:1/0,rate:.5,name:"מדרגה שביעית"}],pe={employee:{rate:.04,maxAmount:6331,ceiling:158280},employer:{rate:.0345,maxAmount:5460,ceiling:158280}},he={rate:.031,additionalRate:.05,threshold:6331,ceiling:158280},ge={basic:2320,married:2320,child:2320,student:1160,oleh:2320,disabled:2900};class G{constructor(){this.taxBrackets=ue,this.bituachLeumiRates=pe,this.healthInsuranceRates=he,this.taxCredits=ge}calculateMonthlySalary(e,t={}){const{maritalStatus:s="single",children:a=0,isStudent:n=!1,isOleh:i=!1,isDisabled:o=!1,pensionContribution:l=.06,hasCompanyCar:c=!1,companyCarValue:u=0}=t,h={gross:e,deductions:{},taxes:{},credits:{},net:0,breakdown:[]},E=e*l;h.deductions.pension=E;let O=e-E;c&&u>0&&(O+=u,h.deductions.companyCarTax=u);const N=this.calculateIncomeTax(O);h.taxes.income=N.total,h.breakdown.push(...N.breakdown);const K=this.calculateTaxCredits(s,a,n,i,o);h.credits=K;const X=this.calculateBituachLeumi(e);h.taxes.bituachLeumi=X;const Q=this.calculateHealthInsurance(e);h.taxes.healthInsurance=Q;const J=Math.max(0,N.total-K.total);h.taxes.netIncome=J;const H=J+X+Q,W=E+H;return h.net=e-W,h.totalTaxes=H,h.totalDeductions=W,h.effectiveTaxRate=H/e*100,h}calculateAnnualSalary(e,t={}){const s=e/12,a=this.calculateMonthlySalary(s,t);return{annual:{gross:e,net:a.net*12,totalTaxes:a.totalTaxes*12,totalDeductions:a.totalDeductions*12,effectiveTaxRate:a.effectiveTaxRate},monthly:a,breakdown:a.breakdown}}calculateIncomeTax(e){let t=e,s=0;const a=[];for(const n of this.taxBrackets){if(t<=0)break;const i=Math.min(t,n.max-n.min);if(i>0){const o=i*n.rate;s+=o,a.push({bracket:n.name,rate:`${(n.rate*100).toFixed(1)}%`,taxableAmount:i,tax:o,range:`${j(n.min)} - ${n.max===1/0?"∞":j(n.max)}`}),t-=i}}return{total:s,breakdown:a}}calculateTaxCredits(e,t,s,a,n){const i={basic:this.taxCredits.basic,married:e==="married"?this.taxCredits.married:0,children:t*this.taxCredits.child,student:s?this.taxCredits.student:0,oleh:a?this.taxCredits.oleh:0,disabled:n?this.taxCredits.disabled:0};return i.total=Object.values(i).reduce((o,l)=>o+l,0),i}calculateBituachLeumi(e){const s=Math.min(e,this.bituachLeumiRates.employee.ceiling)*this.bituachLeumiRates.employee.rate;return Math.min(s,this.bituachLeumiRates.employee.maxAmount)}calculateHealthInsurance(e){let s=Math.min(e,this.healthInsuranceRates.ceiling)*this.healthInsuranceRates.rate;if(e>this.healthInsuranceRates.threshold){const a=Math.min(e-this.healthInsuranceRates.threshold,this.healthInsuranceRates.ceiling-this.healthInsuranceRates.threshold);s+=a*this.healthInsuranceRates.additionalRate}return s}calculateRequiredGross(e,t={}){let s=e,a=e*2,n=1;for(;a-s>n;){const l=(s+a)/2;this.calculateMonthlySalary(l,t).net<e?s=l:a=l}const i=(s+a)/2,o=this.calculateMonthlySalary(i,t);return{requiredGross:i,actualNet:o.net,difference:o.net-e,calculation:o}}compareSalaries(e,t={}){return e.map(s=>({gross:s,calculation:this.calculateMonthlySalary(s,t)}))}getOptimalRanges(e,t={}){return e.map(s=>{const a=this.calculateRequiredGross(s,t);return{targetNet:s,requiredGross:a.requiredGross,actualNet:a.actualNet,effectiveTaxRate:a.calculation.effectiveTaxRate,monthlyTaxes:a.calculation.totalTaxes}})}formatSalaryBreakdown(e,t={}){var o;const{showDetailed:s=!0,currency:a=!0}=t,n=a?j:l=>me(l,{}),i={"שכר ברוטו":n(e.gross),"ניכויי פנסיה":n(e.deductions.pension||0),"מס הכנסה":n(e.taxes.netIncome||0),"ביטוח לאומי":n(e.taxes.bituachLeumi||0),"ביטוח בריאות":n(e.taxes.healthInsurance||0),'סה"כ ניכויים':n(e.totalDeductions||0),"שכר נטו":n(e.net),"שיעור מס אפקטיבי":`${(o=e.effectiveTaxRate)==null?void 0:o.toFixed(1)}%`};return s&&e.breakdown&&(i.breakdown=e.breakdown),e.credits&&(i.credits=e.credits),i}}function j(r){return window.formatCurrency?window.formatCurrency(r):`₪${r.toLocaleString()}`}function me(r,e={}){return window.formatNumber?window.formatNumber(r):r.toLocaleString()}window.IsraeliSalaryCalculator=G;window.salaryCalculator=new G;window.calculateMonthlySalary=(r,e)=>window.salaryCalculator.calculateMonthlySalary(r,e);window.calculateAnnualSalary=(r,e)=>window.salaryCalculator.calculateAnnualSalary(r,e);window.calculateRequiredGross=(r,e)=>window.salaryCalculator.calculateRequiredGross(r,e);console.log("💰 Israeli Salary Calculator loaded successfully");const ne={money:"כסף",income:"הכנסה",expense:"הוצאה",profit:"רווח",loss:"הפסד",savings:"חיסכון",investment:"השקעה",debt:"חוב",credit:"אשראי",budget:"תקציב",balance:"יתרה",transaction:"עסקה",transfer:"העברה",payment:"תשלום",receipt:"קבלה",invoice:"חשבונית",bank:"בנק",account:"חשבון",checkingAccount:"חשבון עובר ושב",savingsAccount:"חשבון חיסכון",deposit:"פיקדון",withdrawal:"משיכה",overdraft:"מינוס",interestRate:"שיעור ריבית",commission:"עמלה",serviceCharge:"דמי ניהול",loan:"הלוואה",mortgage:"משכנתא",creditCard:"כרטיס אשראי",installment:"תשלום",monthlyPayment:"תשלום חודשי",principal:"קרן",interest:"ריבית",stock:"מניה",bond:'אג"ח',fund:"קרן",portfolio:"תיק השקעות",dividend:"דיבידנד",insurance:"ביטוח",premium:"פרמיה",policy:"פוליסה",claim:"תביעה",coverage:"כיסוי",tax:"מס",incomeTax:"מס הכנסה",vatTax:'מע"מ',taxReturn:'דו"ח שנתי',taxRefund:"החזר מס",taxCredit:"זיכוי מס",revenue:"הכנסות",expenses:"הוצאות",netIncome:"הכנסה נטו",grossIncome:"הכנסה ברוטו",cashFlow:"תזרים מזומנים"},ye={shekel:"שקל",shekels:"שקלים",agorot:"אגורות",bituachLeumi:"ביטוח לאומי",healthInsurance:"ביטוח בריאות",arnona:"ארנונה",masHachnaса:"מס הכנסה",maam:'מע"מ',taxAuthority:"רשות המסים",bankHapoalim:"בנק הפועלים",bankLeumi:"בנק לאומי",mizrahiTefahot:"מזרחי טפחות",bankDiscount:"בנק דיסקונט",rent:"שכר דירה",hoaDues:"דמי בית משותף",propertyTax:"ארנונה",salary:"משכורת",wages:"שכר",bonus:"בונוס",overtime:"שעות נוספות",pension:"פנסיה",severancePay:"פיצויים",childAllowance:"קצבת ילדים",unemploymentBenefit:"דמי אבטלה",disabilityAllowance:"קצבת נכות",oldAgePension:"קצבת זקנה",tuition:"שכר לימוד",scholarship:"מלגה",fuel:"דלק",parkingFees:"דמי חניה",carInsurance:"ביטוח רכב",registration:"רישוי",electricity:"חשמל",water:"מים",gas:"גז",internet:"אינטרנט",phone:"טלפון",cable:"כבלים",healthFund:"קופת חולים",privateMedicine:"רפואה פרטית",prescription:"מרשם",groceries:"קניות מזון",supermarket:"סופר",market:"שוק",restaurant:"מסעדה",movies:"קולנוע",theater:"תיאטרון",sports:"ספורט",vacation:"חופשה"},fe={add:"הוסף",edit:"ערוך",delete:"מחק",save:"שמור",cancel:"בטל",confirm:"אשר",view:"צפה",print:"הדפס",export:"יצא",import:"יבא",search:"חפש",filter:"סנן",sort:"מיין",calculate:"חשב",analyze:"נתח",compare:"השווה",forecast:"תחזה",budget:"תקצב",track:"עקוב",monitor:"פקח",update:"עדכן",sync:"סנכרן",backup:"גבה",restore:"שחזר"},ve={active:"פעיל",inactive:"לא פעיל",pending:"ממתין",completed:"הושלם",cancelled:"בוטל",approved:"אושר",rejected:"נדחה",processing:"מעובד",successful:"הצליח",failed:"נכשל",loading:"טוען",saved:"נשמר",error:"שגיאה",warning:"אזהרה",info:"מידע",new:"חדש",updated:"עודכן",deleted:"נמחק"},be={today:"היום",yesterday:"אתמול",tomorrow:"מחר",thisWeek:"השבוע",lastWeek:"שבוע שעבר",nextWeek:"שבוע הבא",thisMonth:"החודש",lastMonth:"חודש שעבר",nextMonth:"חודש הבא",thisYear:"השנה",lastYear:"שנה שעברה",nextYear:"שנה הבאה",quarter:"רבעון",semester:"סמסטר",annual:"שנתי",monthly:"חודשי",weekly:"שבועי",daily:"יומי",hourly:"שעתי"},Se={income:{name:"הכנסות",subcategories:["משכורת","עבודה עצמאית","השקעות","מתנות","הכנסות אחרות"]},housing:{name:"דיור",subcategories:["שכר דירה","ארנונה","דמי בית משותף","תחזוקה","משכנתא"]},utilities:{name:"שירותים",subcategories:["חשמל","מים","גז","אינטרנט","טלפון"]},transportation:{name:"תחבורה",subcategories:["דלק","ביטוח רכב","רישוי","תחבורה ציבורית","חניה"]},food:{name:"מזון",subcategories:["קניות מזון","מסעדות","ביתית","קפה ונשנושים"]},healthcare:{name:"בריאות",subcategories:["ביטוח בריאות","רפואה פרטית","תרופות","טיפולים"]},education:{name:"חינוך",subcategories:["שכר לימוד","ספרים","חוגים","גן ילדים"]},entertainment:{name:"בילויים",subcategories:["קולנוע","מסעדות","ספורט","חופשות"]}},we={addTransaction:"הוסף עסקה",editTransaction:"ערוך עסקה",deleteTransaction:"מחק עסקה",viewTransactions:"צפה בעסקאות",monthlyBudget:"תקציב חודשי",budgetOverrun:"חריגה מהתקציב",savingsGoal:"יעד חיסכון",expenseTracking:"מעקב הוצאות",incomeVsExpenses:"הכנסות מול הוצאות",netWorth:"שווי נטו",cashFlow:"תזרים מזומנים",financialGoals:"יעדים פיננסיים",investmentPortfolio:"תיק השקעות",emergencyFund:"קרן חירום",retirementSavings:"חיסכון לפנסיה",taxPlanning:"תכנון מס",debtManagement:"ניהול חובות",creditScore:"דירוג אשראי",financialFreedom:"חופש פיננסי"},Ee={required:"שדה חובה",invalidAmount:"סכום לא תקין",invalidDate:"תאריך לא תקין",invalidEmail:"כתובת אימייל לא תקינה",invalidPhone:"מספר טלפון לא תקין",duplicateEntry:"רשומה כפולה",insufficientFunds:"אין מספיק כסף",budgetExceeded:"התקציב חרג",networkError:"שגיאת רשת",saveError:"שגיאה בשמירה",loadError:"שגיאה בטעינה",permissionDenied:"הרשאה נדחתה",sessionExpired:"ההפעלה פגה",dataCorrupted:"המידע פגום",backupFailed:"הגיבוי נכשל",importFailed:"הייבוא נכשל",exportFailed:"הייצוא נכשל"},Te={saved:"נשמר בהצלחה",updated:"עודכן בהצלחה",deleted:"נמחק בהצלחה",imported:"יובא בהצלחה",exported:"יוצא בהצלחה",backedUp:"גובה בהצלחה",restored:"שוחזר בהצלחה",synced:"סונכרן בהצלחה",budgetSet:"התקציב נקבע בהצלחה",goalAchieved:"היעד הושג!",paymentProcessed:"התשלום עובד",transactionCompleted:"העסקה הושלמה"};class re{constructor(){this.terms={...ne,...ye,...fe,...ve,...be},this.phrases=we,this.categories=Se,this.errors=Ee,this.success=Te}getTerm(e){return this.terms[e]||e}getPhrase(e){return this.phrases[e]||e}getCategoryName(e){var t;return((t=this.categories[e])==null?void 0:t.name)||e}getSubcategories(e){var t;return((t=this.categories[e])==null?void 0:t.subcategories)||[]}getError(e){return this.errors[e]||"שגיאה לא ידועה"}getSuccess(e){return this.success[e]||"הפעולה הושלמה בהצלחה"}searchTerms(e){const t=[],s=e.toLowerCase();return Object.entries(this.terms).forEach(([a,n])=>{(a.toLowerCase().includes(s)||n.includes(e))&&t.push({english:a,hebrew:n})}),t}getTermsByDomain(e){return({banking:["bank","account","deposit","withdrawal","balance"],taxes:["tax","incomeTax","vatTax","bituachLeumi"],investment:["stock","bond","fund","portfolio","dividend"],housing:["rent","mortgage","arnona","utilities"],insurance:["insurance","premium","policy","claim"]}[e]||[]).map(a=>({english:a,hebrew:this.terms[a]}))}}window.HebrewTermManager=re;window.hebrewTerms=new re;window.getTerm=r=>window.hebrewTerms.getTerm(r);window.getPhrase=r=>window.hebrewTerms.getPhrase(r);window.getError=r=>window.hebrewTerms.getError(r);window.getSuccess=r=>window.hebrewTerms.getSuccess(r);console.log("🔤 Hebrew Financial Terms loaded successfully");const ie={taxes:[{title:"ניצול זיכויי מס",tip:"וודאו שאתם מנצלים את כל זיכויי המס המגיעים לכם - זיכוי על ילדים, נישואין, ולימודים",category:"מסים",priority:"high",savings:"עד ₪2,320 לחודש"},{title:"דיווח שנתי מדויק",tip:"שמרו קבלות והוכחות הוצאה לדיווח השנתי - יכול לחסוך אלפי שקלים במס",category:"מסים",priority:"medium",savings:"עד ₪5,000 לשנה"},{title:"שנת המס הישראלית",tip:"זכרו שהשנה המס בישראל היא מ-1 באפריל עד 31 במרץ, תכננו בהתאם",category:"מסים",priority:"medium",savings:"תכנון טוב"}],banking:[{title:"השוואת עמלות בנקאיות",tip:"השוו עמלות בין הבנקים השונים - הפרש של מאות שקלים לשנה אפשרי",category:"בנקאות",priority:"high",savings:"עד ₪1,200 לשנה"},{title:"חשבון דיגיטלי",tip:"עברו לבנקאות דיגיטלית לחיסכון בעמלות ונוחות בניהול",category:"בנקאות",priority:"medium",savings:"עד ₪500 לשנה"},{title:"מינוס מאושר",tip:"סדרו מינוס מאושר מראש במקום להיכנס למינוס לא מאושר עם עמלות גבוהות",category:"בנקאות",priority:"high",savings:"עד ₪2,000 לשנה"}],housing:[{title:"ארנונה - זכויות הנחה",tip:"בדקו זכאות להנחות ארנונה - משפחות עם ילדים, קשישים, ואנשים עם מוגבלות זכאים להנחות",category:"דיור",priority:"high",savings:"עד ₪3,000 לשנה"},{title:"משכנתא - מחזור",tip:"בדקו אפשרות למחזור משכנתא אם הריבית ירדה משמעותית מאז נטילת ההלוואה",category:"דיור",priority:"high",savings:"עד ₪50,000 לשנה"},{title:"חיסכון בחשמל",tip:"השתמשו במכשירי חשמל חסכוניים וזמני חשמל זול - הפרש משמעותי בחשבון החשמל",category:"דיור",priority:"medium",savings:"עד ₪1,500 לשנה"}],investment:[{title:"פנסיה וקופות גמל",tip:"השתתפו בקופת גמל ופנסיה - זיכוי מס מיידי ובניית עתיד פיננסי",category:"השקעות",priority:"high",savings:"זיכוי מס + עתיד"},{title:"קרן חירום",tip:"צברו קרן חירום של 6-12 משכורות חודשיות לביטחון פיננסי",category:"השקעות",priority:"high",savings:"ביטחון פיננסי"},{title:"השקעה הדרגתית",tip:"השקיעו סכומים קבועים מדי חודש במקום סכום גדול בבת אחת",category:"השקעות",priority:"medium",savings:"מיצוע עלויות"}],shopping:[{title:"השוואת מחירים",tip:"השתמשו באפליקציות השוואת מחירים לפני קניות גדולות - חיסכון משמעותי אפשרי",category:"קניות",priority:"medium",savings:"עד ₪2,000 לשנה"},{title:"קניות בכמויות",tip:"קנו מוצרי יסוד בכמויות גדולות ממועדוני קניות - חיסכון למשפחות",category:"קניות",priority:"medium",savings:"עד ₪3,000 לשנה"},{title:"תכנון רשימת קניות",tip:"תכננו רשימת קניות מראש ודבקו בה למניעת קניות מיותרות",category:"קניות",priority:"medium",savings:"עד ₪1,500 לשנה"}],transportation:[{title:"תחבורה ציבורית",tip:"השתמשו בתחבורה ציבורית במקום רכב פרטי - חיסכון משמעותי בדלק וחניה",category:"תחבורה",priority:"medium",savings:"עד ₪10,000 לשנה"},{title:"ביטוח רכב מקיף",tip:"השוו מחירי ביטוח רכב בין חברות שונות - הפרש של מאות שקלים אפשרי",category:"תחבורה",priority:"high",savings:"עד ₪2,000 לשנה"}]},Ie={january:{title:"ינואר - תכנון השנה החדשה",insights:["זמן מצוין להגדיר יעדים פיננסיים לשנה החדשה","בדקו אם יש עדכונים בשיעורי המס וזיכויים","תכננו את תקציב החופשות לקיץ"]},february:{title:"פברואר - הכנה לשנת המס",insights:["התחילו לאסוף מסמכים לדיווח השנתי","בדקו זכאות לזיכויי מס נוספים","תכננו השקעות שעלולות להשפיע על המס"]},march:{title:"מרץ - סיום שנת המס",insights:["סיום שנת המס הישראלית - זמן אחרון לזיכויים","הגישו דיווח שנתי אם נדרש","תכננו לשנת המס החדשה שמתחילה באפריל"]},april:{title:"אפריל - תחילת שנת מס חדשה",insights:["תחילת שנת המס החדשה - תכננו בהתאם","בדקו עדכוני שיעורי מס וזיכויים","זמן מצוין לסקירת תיק ההשקעות"]}},Ae={holidays:[{title:"חגי תשרי",tip:"תכננו מראש הוצאות החגים - מזון, בגדים, מתנות. חיסכון הדרגתי לאורך השנה",savings:"עד ₪5,000 לחגים"},{title:"פסח",tip:"התחילו לחסוך לפסח כבר מחודש ינואר - הוצאות גבוהות על מזון ונקיון",savings:"עד ₪3,000 לפסח"}],summer:[{title:"חופש הגדול",tip:"תכננו מראש פעילויות לילדים בחופש - מחנות קיץ יכולים להיות יקרים",savings:"עד ₪8,000 לקיץ"}]};class oe{constructor(){this.tips=ie,this.monthlyInsights=Ie,this.seasonalTips=Ae}getTipsByCategory(e){return this.tips[e]||[]}getHighPriorityTips(){const e=[];return Object.values(this.tips).forEach(t=>{t.forEach(s=>{s.priority==="high"&&e.push(s)})}),e}getMonthlyInsights(e=null){e||(e=new Date().toLocaleDateString("en-US",{month:"long"}).toLowerCase());const t={january:"january",february:"february",march:"march",april:"april"};return this.monthlyInsights[t[e]]||null}getSeasonalTips(e){return this.seasonalTips[e]||[]}getPersonalizedTips(e={}){const t=[],{hasChildren:s,hasProperty:a,monthlyIncome:n,age:i}=e;return s&&t.push({title:"זיכוי על ילדים",tip:"וודאו שאתם מקבלים זיכוי מס על כל הילדים - זה יכול להיות אלפי שקלים לשנה",category:"מסים",savings:`עד ₪${s*2320*12} לשנה`}),a&&t.push(...this.getTipsByCategory("housing")),i&&i>45&&t.push({title:"תכנון פרישה",tip:"התחילו לתכנן פרישה - פנסיה תקציבית וקופות גמל חשובות יותר",category:"השקעות",priority:"high"}),n&&n>2e4&&t.push({title:"מס על הכנסה גבוהה",tip:"בדקו אופציות להפחתת מס - פנסיה, קופת גמל, השקעות מועדפות",category:"מסים",priority:"high"}),t}getTipOfTheDay(){const e=[];Object.values(this.tips).forEach(n=>{e.push(...n)});const t=new Date,a=Math.floor((t-new Date(t.getFullYear(),0,0))/(1e3*60*60*24))%e.length;return e[a]}searchTips(e){const t=[];return e.toLowerCase(),Object.values(this.tips).forEach(s=>{s.forEach(a=>{(a.title.includes(e)||a.tip.includes(e)||a.category.includes(e))&&t.push(a)})}),t}getFinancialHealthTips(e){return e>=80?[{title:"מצב פיננסי מצוין",tip:"המשיכו כך! התמקדו בהשקעות ארוכות טווח ותכנון פרישה",category:"כללי"}]:e>=60?[{title:"מצב פיננסי טוב",tip:"שפרו את קרן החירום והפחיתו חובות להגעה למצוינות",category:"כללי"}]:[{title:"זקוק לשיפור",tip:"התמקדו בהפחתת חובות ובניית קרן חירום בסיסית",category:"כללי",priority:"high"}]}}window.IsraeliFinancialTipsManager=oe;window.financialTips=new oe;window.getTipsByCategory=r=>window.financialTips.getTipsByCategory(r);window.getHighPriorityTips=()=>window.financialTips.getHighPriorityTips();window.getTipOfTheDay=()=>window.financialTips.getTipOfTheDay();window.getPersonalizedTips=r=>window.financialTips.getPersonalizedTips(r);console.log("💡 Israeli Financial Tips loaded successfully");class x{constructor(e={}){this.options={container:document.body,position:"top-left",showLabel:!0,...e},this.currentTheme=this.getCurrentTheme(),this.toggleButton=null,this.init()}init(){this.createToggleButton(),this.applyTheme(this.currentTheme),this.setupEventListeners()}getCurrentTheme(){const e=localStorage.getItem("theme");return e||(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}createToggleButton(){const e=document.createElement("button");e.className="theme-toggle",e.setAttribute("aria-label","מעבר בין מצב יום ולילה"),e.title="מעבר בין מצב יום ולילה";const t=document.createElement("span");t.className="theme-toggle-icon";let s=null;return this.options.showLabel&&(s=document.createElement("span"),s.className="theme-toggle-label",s.textContent=this.currentTheme==="dark"?"מצב יום":"מצב לילה"),e.appendChild(t),s&&e.appendChild(s),this.updateButtonIcon(e,this.currentTheme),this.toggleButton=e,e}updateButtonIcon(e,t){const s=e.querySelector(".theme-toggle-icon"),a=e.querySelector(".theme-toggle-label");t==="dark"?(s.innerHTML=`
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"/>
                    <line x1="12" y1="1" x2="12" y2="3"/>
                    <line x1="12" y1="21" x2="12" y2="23"/>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                    <line x1="1" y1="12" x2="3" y2="12"/>
                    <line x1="21" y1="12" x2="23" y2="12"/>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                </svg>
            `,a&&(a.textContent="מצב יום")):(s.innerHTML=`
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                </svg>
            `,a&&(a.textContent="מצב לילה"))}applyTheme(e){document.documentElement.setAttribute("data-theme",e),this.currentTheme=e,this.toggleButton&&this.updateButtonIcon(this.toggleButton,e),localStorage.setItem("theme",e),document.dispatchEvent(new CustomEvent("themeChanged",{detail:{theme:e}}))}toggleTheme(){const e=this.currentTheme==="light"?"dark":"light";this.applyTheme(e)}setupEventListeners(){this.toggleButton&&this.toggleButton.addEventListener("click",()=>{this.toggleTheme()}),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>{localStorage.getItem("theme")||this.applyTheme(t.matches?"dark":"light")})}render(e=null){const t=e||this.options.container;return t&&this.toggleButton&&t.appendChild(this.toggleButton),this.toggleButton}getHTML(){const e=this.currentTheme,a=e==="dark"?`<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"/>
            <line x1="12" y1="1" x2="12" y2="3"/>
            <line x1="12" y1="21" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="3" y2="12"/>
            <line x1="21" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
        </svg>`:`<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>`,n=this.options.showLabel?`<span class="theme-toggle-label">${e==="dark"?"מצב יום":"מצב לילה"}</span>`:"";return`
            <button class="theme-toggle" aria-label="מעבר בין מצב יום ולילה" title="מעבר בין מצב יום ולילה">
                <span class="theme-toggle-icon">${a}</span>
                ${n}
            </button>
        `}static createSimpleToggle(){return new x({showLabel:!1,position:"top-right"})}static createLabeledToggle(){return new x({showLabel:!0,position:"top-left"})}}const Ce="modulepreload",De=function(r){return"/Personal-Finance-/"+r},Z={},S=function(e,t,s){let a=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),o=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));a=Promise.allSettled(t.map(l=>{if(l=De(l),l in Z)return;Z[l]=!0;const c=l.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const h=document.createElement("link");if(h.rel=c?"stylesheet":Ce,c||(h.as="script"),h.crossOrigin="",h.href=l,o&&h.setAttribute("nonce",o),document.head.appendChild(h),c)return new Promise((E,k)=>{h.addEventListener("load",E),h.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${l}`)))})}))}function n(i){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i}return a.then(i=>{for(const o of i||[])o.status==="rejected"&&n(o.reason);return e().catch(n)})};class U{constructor(e,t={}){this.container=e,this.options={mode:"add",transaction:null,onSave:null,onCancel:null,...t},this.formElement=null,this.init()}init(){this.render(),this.bindEvents()}render(){var s,a,n,i,o,l;const e=this.options.mode==="edit",t=this.options.transaction||{};this.container.innerHTML=`
            <div class="transaction-form-container">
                <div class="transaction-form-header">
                    <h2 class="form-title">${e?"עריכת עסקה":"הוספת עסקה חדשה"}</h2>
                    <button type="button" class="btn-close" data-action="cancel">×</button>
                </div>

                <form class="transaction-form" id="transactionForm">
                    <!-- Transaction Type -->
                    <div class="form-group">
                        <label class="form-label">סוג עסקה</label>
                        <div class="transaction-type-tabs">
                            <input type="radio" id="type-expense" name="type" value="expense" 
                                   ${t.type!=="income"?"checked":""}>
                            <label for="type-expense" class="type-tab expense-tab">
                                <span class="tab-icon">💸</span>
                                <span class="tab-text">הוצאה</span>
                            </label>
                            
                            <input type="radio" id="type-income" name="type" value="income"
                                   ${t.type==="income"?"checked":""}>
                            <label for="type-income" class="type-tab income-tab">
                                <span class="tab-icon">💰</span>
                                <span class="tab-text">הכנסה</span>
                            </label>
                        </div>
                    </div>

                    <!-- Amount -->
                    <div class="form-group">
                        <label for="amount" class="form-label required">סכום</label>
                        <div class="amount-input-container">
                            <input type="number" id="amount" name="amount" 
                                   class="form-input amount-input" 
                                   placeholder="0.00" 
                                   step="0.01" 
                                   min="0"
                                   value="${t.amount||""}"
                                   required>
                            <span class="currency-symbol">₪</span>
                        </div>
                        <div class="amount-preview"></div>
                    </div>

                    <!-- Description -->
                    <div class="form-group">
                        <label for="description" class="form-label required">תיאור</label>
                        <input type="text" id="description" name="description" 
                               class="form-input" 
                               placeholder="תיאור העסקה..."
                               value="${t.description||""}"
                               required>
                    </div>

                    <!-- Category -->
                    <div class="form-group">
                        <label for="category" class="form-label required">קטגוריה</label>
                        <select id="category" name="category" class="form-input" required>
                            <option value="">בחר קטגוריה...</option>
                        </select>
                        <button type="button" class="btn-secondary btn-sm add-category-btn">
                            + קטגוריה חדשה
                        </button>
                    </div>

                    <!-- Account -->
                    <div class="form-group">
                        <label for="account" class="form-label required">חשבון</label>
                        <select id="account" name="account" class="form-input" required>
                            <option value="">בחר חשבון...</option>
                        </select>
                    </div>

                    <!-- Date -->
                    <div class="form-group">
                        <label for="date" class="form-label required">תאריך</label>
                        <input type="date" id="date" name="date" 
                               class="form-input"
                               value="${t.date||new Date().toISOString().split("T")[0]}"
                               required>
                    </div>

                    <!-- Tags -->
                    <div class="form-group">
                        <label for="tags" class="form-label">תגיות</label>
                        <div class="tags-input-container">
                            <input type="text" id="tags" name="tags" 
                                   class="form-input tags-input" 
                                   placeholder="הקלד תגית והקש Enter או פסיק..."
                                   autocomplete="off">
                            <input type="hidden" id="hiddenTags" name="hiddenTags" value="">
                            <div class="tags-suggestions" style="display: none;"></div>
                        </div>
                        <div class="selected-tags"></div>
                        <div class="tags-help">
                            <small class="help-text">השתמש במקש Enter או פסיק להוספת תגית • מקש Backspace למחיקת התגית האחרונה</small>
                        </div>
                    </div>

                    <!-- Notes -->
                    <div class="form-group">
                        <label for="notes" class="form-label">הערות</label>
                        <div class="notes-container">
                            <textarea id="notes" name="notes" 
                                      class="form-input form-textarea notes-textarea" 
                                      placeholder="הערות נוספות על העסקה..."
                                      rows="4"
                                      maxlength="500"
                                      dir="auto">${t.notes||""}</textarea>
                            <div class="notes-footer">
                                <div class="character-count">
                                    <span class="current-count">0</span>/<span class="max-count">500</span> תווים
                                </div>
                                <div class="notes-formatting-buttons">
                                    <button type="button" class="formatting-btn" data-format="bullet" title="רשימה">• רשימה</button>
                                    <button type="button" class="formatting-btn" data-format="date" title="הוסף תאריך">📅 תאריך</button>
                                    <button type="button" class="formatting-btn" data-format="clear" title="נקה טקסט">🗑️ נקה</button>
                                </div>
                            </div>
                        </div>
                        <div class="notes-suggestions">
                            <div class="suggestion-templates">
                                <button type="button" class="note-template" data-template="payment">💳 תשלום בוצע</button>
                                <button type="button" class="note-template" data-template="receipt">🧾 התקבלה קבלה</button>
                                <button type="button" class="note-template" data-template="business">💼 הוצאה עסקית</button>
                                <button type="button" class="note-template" data-template="personal">👤 הוצאה אישית</button>
                            </div>
                        </div>
                    </div>

                    <!-- Transaction Status & Approval -->
                    <div class="form-group">
                        <label class="form-label">סטטוס העסקה</label>
                        <div class="transaction-status-container">
                            <div class="status-selector">
                                <select id="transactionStatus" name="transactionStatus" class="form-input status-select">
                                    <option value="ממתין" ${(t.status||"ממתין")==="ממתין"?"selected":""}>ממתין לאישור</option>
                                    <option value="מאושר" ${t.status==="מאושר"?"selected":""}>מאושר</option>
                                    <option value="נדחה" ${t.status==="נדחה"?"selected":""}>נדחה</option>
                                    <option value="בביקורת" ${t.status==="בביקורת"?"selected":""}>בביקורת</option>
                                </select>
                                <div class="status-indicator">
                                    <span class="status-badge status-${(t.status||"ממתין").replace("ממתין","pending").replace("מאושר","approved").replace("נדחה","rejected").replace("בביקורת","review")}">
                                        ${this.getStatusIcon(t.status||"ממתין")}
                                        <span class="status-text">${t.status||"ממתין"}</span>
                                    </span>
                                </div>
                            </div>
                            
                            <div class="approval-details" style="display: ${t.status&&t.status!=="ממתין"?"block":"none"}">
                                <div class="approval-info">
                                    <div class="form-group">
                                        <label for="approver" class="form-label">מאשר/דוחה</label>
                                        <input type="text" id="approver" name="approver" 
                                               class="form-input" 
                                               placeholder="שם המאשר..."
                                               value="${t.approver||""}">
                                    </div>
                                    <div class="form-group">
                                        <label for="approvalDate" class="form-label">תאריך אישור/דחייה</label>
                                        <input type="datetime-local" id="approvalDate" name="approvalDate" 
                                               class="form-input"
                                               value="${t.approvalDate||""}">
                                    </div>
                                    <div class="form-group">
                                        <label for="approvalNotes" class="form-label">הערות אישור</label>
                                        <textarea id="approvalNotes" name="approvalNotes" 
                                                  class="form-input form-textarea" 
                                                  placeholder="הערות על האישור או הדחייה..."
                                                  rows="2">${t.approvalNotes||""}</textarea>
                                    </div>
                                </div>
                                
                                <div class="quick-approval-actions">
                                    <button type="button" class="quick-action-btn approve-btn" data-action="approve">
                                        ✅ אשר עסקה
                                    </button>
                                    <button type="button" class="quick-action-btn reject-btn" data-action="reject">
                                        ❌ דחה עסקה
                                    </button>
                                    <button type="button" class="quick-action-btn review-btn" data-action="review">
                                        🔍 שלח לביקורת
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Receipt Photos -->
                    <div class="form-group">
                        <label class="form-label">תמונות קבלה</label>
                        <div class="receipt-upload-area">
                            <input type="file" id="receiptFiles" name="receiptFiles" 
                                   class="file-input" 
                                   multiple 
                                   accept="image/*,application/pdf">
                            <label for="receiptFiles" class="file-upload-label">
                                <span class="upload-icon">📷</span>
                                <span class="upload-text">לחץ להוספת תמונות קבלה או גרור קבצים לכאן</span>
                                <span class="upload-hint">PNG, JPG, PDF עד 5MB לקובץ</span>
                            </label>
                        </div>
                        <div class="receipt-preview-container"></div>
                    </div>

                    <!-- Location Tracking -->
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="trackLocation" name="trackLocation" 
                                   class="form-checkbox"
                                   ${t.location?"checked":""}>
                            הוסף מיקום לעסקה
                        </label>
                        <div class="location-container" style="display: ${t.location?"block":"none"}">
                            <div class="location-input-group">
                                <input type="text" id="locationName" name="locationName" 
                                       class="form-input location-input" 
                                       placeholder="שם המיקום (לדוגמה: סופר ויקטורי רמת גן)"
                                       value="${((s=t.location)==null?void 0:s.name)||""}"
                                       readonly>
                                <button type="button" class="btn-secondary detect-location-btn" title="זהה מיקום נוכחי">
                                    📍 זהה מיקום
                                </button>
                                <button type="button" class="btn-ghost search-location-btn" title="חפש מיקום">
                                    🔍 חפש
                                </button>
                            </div>
                            
                            <div class="location-details" style="display: ${(a=t.location)!=null&&a.address?"block":"none"}">
                                <div class="location-info">
                                    <div class="location-address">
                                        <span class="location-icon">📍</span>
                                        <span class="address-text">${((n=t.location)==null?void 0:n.address)||""}</span>
                                    </div>
                                    ${(i=t.location)!=null&&i.coords?`
                                    <div class="location-coords">
                                        <span class="coords-label">קואורדינטות:</span>
                                        <span class="coords-text">${t.location.coords.lat.toFixed(6)}, ${t.location.coords.lng.toFixed(6)}</span>
                                    </div>
                                    `:""}
                                    <div class="location-actions">
                                        <button type="button" class="btn-ghost btn-sm view-map-btn" title="צפה במפה">
                                            🗺️ צפה במפה
                                        </button>
                                        <button type="button" class="btn-ghost btn-sm clear-location-btn" title="מחק מיקום">
                                            🗑️ מחק מיקום
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="location-search-results" style="display: none;"></div>
                            
                            <div class="location-help">
                                <small class="help-text">
                                    💡 הוספת מיקום עוזרת לסיווג הוצאות ומעקב אחר דפוסי צריכה לפי מקום
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- Transaction Splitting -->
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="splitTransaction" name="splitTransaction" 
                                   class="form-checkbox"
                                   ${(o=t.split)!=null&&o.enabled?"checked":""}>
                            פיצול עסקה בין קטגוריות
                        </label>
                        <div class="split-container" style="display: ${(l=t.split)!=null&&l.enabled?"block":"none"}">
                            <div class="split-explanation">
                                <div class="split-info">
                                    💡 פיצול עסקה מאפשר לחלק עסקה אחת בין מספר קטגוריות
                                    <br>
                                    <small>לדוגמה: רכישה בסופר (מזון + מוצרי ניקיון + יופי)</small>
                                </div>
                                <div class="split-total">
                                    <span class="total-label">סה"כ:</span>
                                    <span class="split-total-amount">₪ 0.00</span>
                                    <span class="remaining-amount" style="display: none;">
                                        נותר: <span class="remaining-value">₪ 0.00</span>
                                    </span>
                                </div>
                            </div>
                            
                            <div class="split-items-container">
                                <div class="split-items-list"></div>
                                <button type="button" class="btn-secondary btn-sm add-split-item">
                                    + הוסף פיצול
                                </button>
                            </div>
                            
                            <div class="split-actions">
                                <button type="button" class="btn-ghost btn-sm auto-split-btn" title="פיצול אוטומטי שווה">
                                    ⚖️ פיצול שווה
                                </button>
                                <button type="button" class="btn-ghost btn-sm percentage-split-btn" title="פיצול לפי אחוזים">
                                    % פיצול אחוזי
                                </button>
                                <button type="button" class="btn-ghost btn-sm clear-splits-btn" title="נקה פיצולים">
                                    🗑️ נקה הכל
                                </button>
                            </div>
                            
                            <div class="split-validation">
                                <div class="validation-message" style="display: none;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Recurring Transaction -->
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="isRecurring" name="isRecurring" 
                                   class="form-checkbox"
                                   ${t.isRecurring?"checked":""}>
                            עסקה חוזרת
                        </label>
                        <div class="recurring-options" style="display: ${t.isRecurring?"block":"none"}">
                            <div class="recurring-grid">
                                <div class="form-group">
                                    <label for="recurringFrequency" class="form-label">תדירות</label>
                                    <select id="recurringFrequency" name="recurringFrequency" class="form-input">
                                        <option value="weekly" ${t.recurringFrequency==="weekly"?"selected":""}>שבועי</option>
                                        <option value="biweekly" ${t.recurringFrequency==="biweekly"?"selected":""}>דו-שבועי</option>
                                        <option value="monthly" ${t.recurringFrequency==="monthly"?"selected":""}>חודשי</option>
                                        <option value="quarterly" ${t.recurringFrequency==="quarterly"?"selected":""}>רבעוני</option>
                                        <option value="yearly" ${t.recurringFrequency==="yearly"?"selected":""}>שנתי</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="recurringEndDate" class="form-label">תאריך סיום (אופציונלי)</label>
                                    <input type="date" id="recurringEndDate" name="recurringEndDate" 
                                           class="form-input"
                                           value="${t.recurringEndDate||""}">
                                </div>
                                <div class="form-group">
                                    <label for="recurringCount" class="form-label">מספר פעמים (אופציונלי)</label>
                                    <input type="number" id="recurringCount" name="recurringCount" 
                                           class="form-input" 
                                           placeholder="ללא הגבלה"
                                           min="1"
                                           value="${t.recurringCount||""}">
                                </div>
                            </div>
                            <div class="recurring-preview">
                                <small class="recurring-preview-text"></small>
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">
                            ${e?"עדכן עסקה":"שמור עסקה"}
                        </button>
                        <button type="button" class="btn-secondary" data-action="cancel">
                            ביטול
                        </button>
                        ${e?`
                            <button type="button" class="btn-error delete-btn" data-action="delete">
                                מחק עסקה
                            </button>
                        `:""}
                    </div>
                </form>
            </div>
        `,this.formElement=this.container.querySelector("#transactionForm"),this.loadCategories(),this.loadAccounts(),this.initializeAmount(),this.initializeTags(),this.initializeNotes(),this.initializeApprovalSystem(),this.initializeReceiptUpload(),this.initializeLocationTracking(),this.initializeTransactionSplitting()}async loadCategories(){try{const{DataManager:e}=await S(async()=>{const{DataManager:i}=await Promise.resolve().then(()=>F);return{DataManager:i}},void 0),t=await e.getCategories(),s=this.container.querySelector("#category");s.innerHTML='<option value="">בחר קטגוריה...</option>';const a=t.filter(i=>i.type==="expense"),n=t.filter(i=>i.type==="income");if(a.length>0){const i=document.createElement("optgroup");i.label="הוצאות",a.forEach(o=>{var c;const l=document.createElement("option");l.value=o.id,l.textContent=o.name,((c=this.options.transaction)==null?void 0:c.category)===o.id&&(l.selected=!0),i.appendChild(l)}),s.appendChild(i)}if(n.length>0){const i=document.createElement("optgroup");i.label="הכנסות",n.forEach(o=>{var c;const l=document.createElement("option");l.value=o.id,l.textContent=o.name,((c=this.options.transaction)==null?void 0:c.category)===o.id&&(l.selected=!0),i.appendChild(l)}),s.appendChild(i)}}catch(e){console.error("Failed to load categories:",e)}}async loadAccounts(){try{const{DataManager:e}=await S(async()=>{const{DataManager:a}=await Promise.resolve().then(()=>F);return{DataManager:a}},void 0),t=await e.getAccounts(),s=this.container.querySelector("#account");t.forEach(a=>{var i;const n=document.createElement("option");n.value=a.id,n.textContent=`${a.name} (${a.type})`,((i=this.options.transaction)==null?void 0:i.account)===a.id&&(n.selected=!0),s.appendChild(n)})}catch(e){console.error("Failed to load accounts:",e)}}initializeAmount(){const e=this.container.querySelector("#amount"),t=this.container.querySelector(".amount-preview"),s=()=>{const a=parseFloat(e.value);!isNaN(a)&&a>0?(t.textContent=this.formatCurrency(a),t.style.display="block"):t.style.display="none"};e.addEventListener("input",s),s()}initializeTags(){var s;const e=this.container.querySelector("#tags");this.container.querySelector(".selected-tags");const t=this.container.querySelector(".tags-suggestions");this.selectedTags=(s=this.options.transaction)!=null&&s.tags?[...this.options.transaction.tags]:[],this.commonHebrewTags=["מזומן","כרטיס אשראי","העברה בנקאית","חשבונית","קבלה","עסקי","אישי","דחוף","חודשי","שנתי","מכולת","דלק","תחבורה","בילוי","בריאות","חינוך","ביגוד","טכנולוגיה","מתנה","חסכון","חירום","נסיעה","מסעדה","ספורט","תרבות"],this.updateTagsDisplay(),e.value="",e.addEventListener("input",a=>{const n=a.target.value.trim();this.showTagSuggestions(n)}),e.addEventListener("keydown",a=>{a.key==="Enter"||a.key===","?(a.preventDefault(),this.addTagFromInput()):a.key==="Backspace"&&a.target.value===""&&this.selectedTags.length>0&&this.removeTag(this.selectedTags.length-1)}),document.addEventListener("click",a=>{!t.contains(a.target)&&a.target!==e&&this.hideSuggestions()}),t.addEventListener("click",a=>{const n=a.target.closest(".tag-suggestion");if(n){const i=n.dataset.tag;this.addTag(i),e.value="",this.hideSuggestions()}})}addTagFromInput(){const e=this.container.querySelector("#tags"),t=e.value.trim();t&&!this.selectedTags.includes(t)&&(this.addTag(t),e.value="",this.hideSuggestions())}addTag(e){e&&!this.selectedTags.includes(e)&&this.selectedTags.length<10&&(this.selectedTags.push(e),this.updateTagsDisplay())}removeTag(e){this.selectedTags.splice(e,1),this.updateTagsDisplay()}updateTagsDisplay(){const e=this.container.querySelector(".selected-tags");e.innerHTML=this.selectedTags.map((s,a)=>`
            <span class="tag-item" data-index="${a}">
                <span class="tag-text">${s}</span>
                <button type="button" class="tag-remove" data-index="${a}" title="הסר תגית">×</button>
            </span>
        `).join(""),e.querySelectorAll(".tag-remove").forEach(s=>{s.addEventListener("click",a=>{a.preventDefault();const n=parseInt(a.target.dataset.index);this.removeTag(n)})});const t=this.container.querySelector("#hiddenTags");t&&(t.value=this.selectedTags.join(","))}showTagSuggestions(e){const t=this.container.querySelector(".tags-suggestions");if(!e){this.hideSuggestions();return}const s=this.commonHebrewTags.filter(a=>a.includes(e)&&!this.selectedTags.includes(a)).slice(0,5);if(s.length===0){this.hideSuggestions();return}t.innerHTML=s.map(a=>`
            <div class="tag-suggestion" data-tag="${a}">
                <span class="suggestion-text">${a}</span>
                <span class="suggestion-hint">לחץ להוספה</span>
            </div>
        `).join(""),t.style.display="block"}hideSuggestions(){const e=this.container.querySelector(".tags-suggestions");e.style.display="none"}initializeNotes(){const e=this.container.querySelector("#notes"),t=this.container.querySelector(".current-count"),s=this.container.querySelectorAll(".formatting-btn"),a=this.container.querySelectorAll(".note-template"),n=()=>{const o=e.value.length;t.textContent=o,o>450?t.style.color="var(--error-color)":o>350?t.style.color="var(--warning-color)":t.style.color="var(--text-secondary)"};n(),e.addEventListener("input",n),s.forEach(o=>{o.addEventListener("click",l=>{l.preventDefault();const c=l.target.dataset.format;this.handleNotesFormatting(c,e)})}),a.forEach(o=>{o.addEventListener("click",l=>{l.preventDefault();const c=l.target.dataset.template;this.insertNoteTemplate(c,e)})});const i=()=>{e.style.height="auto",e.style.height=Math.min(e.scrollHeight,200)+"px"};e.addEventListener("input",i),i()}handleNotesFormatting(e,t){const s=t.selectionStart,a=t.selectionEnd,n=t.value;switch(e){case"bullet":const o=n.substring(s,a).split(`
`).map(u=>u.trim()?`• ${u.trim()}`:u).join(`
`);this.insertTextAtCursor(t,o,s,a);break;case"date":const c=new Date().toLocaleDateString("he-IL",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"});this.insertTextAtCursor(t,`📅 ${c}`,s,a);break;case"clear":confirm("האם אתה בטוח שברצונך למחוק את כל ההערות?")&&(t.value="",t.focus(),t.dispatchEvent(new Event("input")));break}}insertNoteTemplate(e,t){const a={payment:"💳 תשלום בוצע בהצלחה",receipt:"🧾 התקבלה קבלה למס הכנסה",business:"💼 הוצאה עסקית - ניתן לצירוף לדוח",personal:"👤 הוצאה אישית"}[e];if(a){const n=t.value,i=n?`${n}
${a}`:a;t.value=i,t.focus(),t.setSelectionRange(i.length,i.length),t.dispatchEvent(new Event("input"))}}insertTextAtCursor(e,t,s,a){const n=e.value.substring(0,s),i=e.value.substring(a);e.value=n+t+i;const o=s+t.length;e.focus(),e.setSelectionRange(o,o),e.dispatchEvent(new Event("input"))}getStatusIcon(e){return{ממתין:"⏳",מאושר:"✅",נדחה:"❌",בביקורת:"🔍"}[e]||"⏳"}initializeApprovalSystem(){const e=this.container.querySelector("#transactionStatus"),t=this.container.querySelector(".approval-details");this.container.querySelector(".status-badge");const s=this.container.querySelectorAll(".quick-action-btn");e.addEventListener("change",a=>{const n=a.target.value;if(this.updateStatusDisplay(n),n==="ממתין")t.style.display="none";else{t.style.display="block";const i=this.container.querySelector("#approvalDate");if(!i.value){const o=new Date,l=new Date(o.getTime()-o.getTimezoneOffset()*6e4).toISOString().slice(0,16);i.value=l}}}),s.forEach(a=>{a.addEventListener("click",n=>{n.preventDefault();const i=n.target.dataset.action;this.handleQuickApprovalAction(i)})}),this.updateStatusDisplay(e.value)}updateStatusDisplay(e){const t=this.container.querySelector(".status-badge");this.container.querySelector(".status-text"),t.className=`status-badge status-${e.replace("ממתין","pending").replace("מאושר","approved").replace("נדחה","rejected").replace("בביקורת","review")}`,t.innerHTML=`
            ${this.getStatusIcon(e)}
            <span class="status-text">${e}</span>
        `}handleQuickApprovalAction(e){const t=this.container.querySelector("#transactionStatus"),s=this.container.querySelector("#approver"),a=this.container.querySelector("#approvalDate"),n=this.container.querySelector("#approvalNotes"),i="משתמש נוכחי",o=new Date,l=new Date(o.getTime()-o.getTimezoneOffset()*6e4).toISOString().slice(0,16);switch(e){case"approve":t.value="מאושר",s.value=i,a.value=l,n.value=n.value||"✅ עסקה אושרה";break;case"reject":t.value="נדחה",s.value=i,a.value=l,n.value=n.value||"❌ עסקה נדחתה - נדרש מידע נוסף";break;case"review":t.value="בביקורת",s.value=i,a.value=l,n.value=n.value||"🔍 העסקה נשלחה לביקורת נוספת";break}t.dispatchEvent(new Event("change")),this.showStatusMessage(e)}showStatusMessage(e){const t={approve:"העסקה אושרה בהצלחה! ✅",reject:"העסקה נדחתה ❌",review:"העסקה נשלחה לביקורת 🔍"};if(window.showToast){const s=e==="approve"?"success":e==="reject"?"error":"info";window.showToast(t[e],s)}}initializeReceiptUpload(){var s;const e=this.container.querySelector("#receiptFiles"),t=this.container.querySelector(".receipt-upload-area");this.container.querySelector(".receipt-preview-container"),this.receiptFiles=[],(s=this.options.transaction)!=null&&s.receipts&&(this.receiptFiles=[...this.options.transaction.receipts],this.updateReceiptPreview()),e.addEventListener("change",a=>{this.handleFileSelect(a.target.files)}),t.addEventListener("dragover",a=>{a.preventDefault(),a.stopPropagation(),t.classList.add("drag-over")}),t.addEventListener("dragleave",a=>{a.preventDefault(),a.stopPropagation(),t.classList.remove("drag-over")}),t.addEventListener("drop",a=>{a.preventDefault(),a.stopPropagation(),t.classList.remove("drag-over"),this.handleFileSelect(a.dataTransfer.files)})}async handleFileSelect(e){if(this.receiptFiles.length+e.length>10){this.showErrorMessage("ניתן להעלות עד 10 קבצים");return}for(let a of e){if(a.size>5242880){this.showErrorMessage(`קובץ "${a.name}" גדול מדי (מקסימום 5MB)`);continue}if(!this.isValidFileType(a)){this.showErrorMessage(`סוג קובץ לא נתמך: ${a.name}`);continue}try{const n=await this.processReceiptFile(a);this.receiptFiles.push(n)}catch(n){console.error("Error processing file:",n),this.showErrorMessage(`שגיאה בעיבוד קובץ: ${a.name}`)}}this.updateReceiptPreview()}isValidFileType(e){return["image/jpeg","image/jpg","image/png","image/gif","image/webp","application/pdf"].includes(e.type)}async processReceiptFile(e){return new Promise((t,s)=>{const a=new FileReader;a.onload=n=>{const i={id:this.generateId(),name:e.name,type:e.type,size:e.size,data:n.target.result,uploadedAt:new Date().toISOString()};t(i)},a.onerror=()=>{s(new Error("Failed to read file"))},a.readAsDataURL(e)})}updateReceiptPreview(){const e=this.container.querySelector(".receipt-preview-container");if(this.receiptFiles.length===0){e.innerHTML="";return}e.innerHTML=`
            <div class="receipt-preview-header">
                <span class="preview-title">תמונות שנבחרו (${this.receiptFiles.length})</span>
                <button type="button" class="btn-ghost btn-sm clear-all-receipts">מחק הכל</button>
            </div>
            <div class="receipt-preview-grid">
                ${this.receiptFiles.map(s=>this.createReceiptPreview(s)).join("")}
            </div>
        `,e.querySelectorAll(".remove-receipt").forEach(s=>{s.addEventListener("click",a=>{const n=a.target.dataset.receiptId;this.removeReceipt(n)})});const t=e.querySelector(".clear-all-receipts");t&&t.addEventListener("click",()=>{this.receiptFiles=[],this.updateReceiptPreview()}),e.querySelectorAll(".view-receipt").forEach(s=>{s.addEventListener("click",a=>{const n=a.target.dataset.receiptId;this.viewReceipt(n)})})}createReceiptPreview(e){const t=e.type.startsWith("image/"),s=(e.size/1024/1024).toFixed(1);return`
            <div class="receipt-preview-item" data-receipt-id="${e.id}">
                <div class="receipt-thumbnail">
                    ${t?`<img src="${e.data}" alt="${e.name}" class="receipt-image">`:`<div class="receipt-pdf">
                            <span class="pdf-icon">📄</span>
                            <span class="pdf-label">PDF</span>
                        </div>`}
                </div>
                <div class="receipt-info">
                    <div class="receipt-name" title="${e.name}">${this.truncateText(e.name,15)}</div>
                    <div class="receipt-size">${s} MB</div>
                </div>
                <div class="receipt-actions">
                    <button type="button" class="btn-ghost btn-xs view-receipt" data-receipt-id="${e.id}" title="צפה">👁️</button>
                    <button type="button" class="btn-error btn-xs remove-receipt" data-receipt-id="${e.id}" title="מחק">🗑️</button>
                </div>
            </div>
        `}removeReceipt(e){this.receiptFiles=this.receiptFiles.filter(t=>t.id!==e),this.updateReceiptPreview()}initializeLocationTracking(){var l;const e=this.container.querySelector("#trackLocation"),t=this.container.querySelector(".location-container"),s=this.container.querySelector(".detect-location-btn"),a=this.container.querySelector(".search-location-btn"),n=this.container.querySelector(".clear-location-btn"),i=this.container.querySelector(".view-map-btn"),o=this.container.querySelector("#locationName");this.currentLocation=((l=this.options.transaction)==null?void 0:l.location)||null,e.addEventListener("change",()=>{t.style.display=e.checked?"block":"none",e.checked||this.clearLocation()}),s.addEventListener("click",()=>{this.detectCurrentLocation()}),a.addEventListener("click",()=>{this.showLocationSearch()}),n.addEventListener("click",()=>{this.clearLocation()}),i.addEventListener("click",()=>{this.viewLocationOnMap()}),o.addEventListener("keydown",c=>{c.key==="Enter"&&(c.preventDefault(),this.showLocationSearch())})}async detectCurrentLocation(){const e=this.container.querySelector(".detect-location-btn"),t=e.innerHTML;try{if(e.innerHTML="📍 מזהה...",e.disabled=!0,!navigator.geolocation)throw new Error("הדפדפן לא תומך בזיהוי מיקום");const s=await this.getCurrentPosition(),a={lat:s.coords.latitude,lng:s.coords.longitude},n=await this.reverseGeocode(a);this.setLocation({name:n.name||"מיקום נוכחי",address:n.formatted,coords:a,detectedAt:new Date().toISOString()}),this.showSuccessMessage("מיקום זוהה בהצלחה")}catch(s){console.error("Location detection failed:",s),this.showErrorMessage(s.message||"שגיאה בזיהוי המיקום")}finally{e.innerHTML=t,e.disabled=!1}}getCurrentPosition(){return new Promise((e,t)=>{const s={enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5};navigator.geolocation.getCurrentPosition(e,t,s)})}async reverseGeocode(e){try{const t=await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${e.lat}&lon=${e.lng}&format=json&addressdetails=1&accept-language=he`);if(!t.ok)throw new Error("Failed to fetch address");const s=await t.json();return{name:this.extractLocationName(s),formatted:s.display_name||`${e.lat.toFixed(6)}, ${e.lng.toFixed(6)}`,details:s.address||{}}}catch(t){return console.error("Reverse geocoding failed:",t),{name:"מיקום נוכחי",formatted:`${e.lat.toFixed(6)}, ${e.lng.toFixed(6)}`,details:{}}}}extractLocationName(e){const t=e.address||{};return t.shop?t.shop:t.amenity?t.amenity:t.building?t.building:t.suburb?t.suburb:t.neighbourhood?t.neighbourhood:t.city_district?t.city_district:t.city||t.town?t.city||t.town:"מיקום נוכחי"}async showLocationSearch(){const e=this.container.querySelector("#locationName").value.trim(),t=this.container.querySelector(".location-search-results");if(!e){t.style.display="none";return}try{t.innerHTML='<div class="search-loading">מחפש מיקומים...</div>',t.style.display="block";const s=await this.searchLocations(e);if(s.length===0){t.innerHTML='<div class="no-results">לא נמצאו תוצאות</div>';return}t.innerHTML=`
                <div class="search-results-header">תוצאות חיפוש:</div>
                <div class="search-results-list">
                    ${s.map((a,n)=>`
                        <div class="search-result-item" data-index="${n}">
                            <div class="result-name">${a.name}</div>
                            <div class="result-address">${a.address}</div>
                        </div>
                    `).join("")}
                </div>
            `,t.querySelectorAll(".search-result-item").forEach(a=>{a.addEventListener("click",()=>{const n=parseInt(a.dataset.index);this.selectSearchResult(s[n]),t.style.display="none"})})}catch(s){console.error("Location search failed:",s),t.innerHTML='<div class="search-error">שגיאה בחיפוש מיקומים</div>'}}async searchLocations(e){try{const t=await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(e)}&format=json&addressdetails=1&limit=5&countrycodes=il&accept-language=he`);if(!t.ok)throw new Error("Search request failed");return(await t.json()).map(a=>({name:this.extractLocationName(a),address:a.display_name,coords:{lat:parseFloat(a.lat),lng:parseFloat(a.lon)},details:a.address||{}}))}catch(t){throw console.error("Location search error:",t),t}}selectSearchResult(e){this.setLocation({name:e.name,address:e.address,coords:e.coords,selectedAt:new Date().toISOString()}),this.showSuccessMessage(`נבחר מיקום: ${e.name}`)}setLocation(e){this.currentLocation=e;const t=this.container.querySelector("#locationName"),s=this.container.querySelector(".location-details"),a=this.container.querySelector(".address-text"),n=this.container.querySelector(".coords-text");t.value=e.name,a.textContent=e.address,e.coords&&n&&(n.textContent=`${e.coords.lat.toFixed(6)}, ${e.coords.lng.toFixed(6)}`),s.style.display="block"}clearLocation(){this.currentLocation=null;const e=this.container.querySelector("#locationName"),t=this.container.querySelector(".location-details"),s=this.container.querySelector(".location-search-results");e.value="",t.style.display="none",s.style.display="none"}async viewLocationOnMap(){var e;if(!((e=this.currentLocation)!=null&&e.coords)){this.showErrorMessage("אין קואורדינטות זמינות למיקום");return}try{const{Modal:t}=await S(async()=>{const{Modal:o}=await import("./Modal-CiVLbcbL.js");return{Modal:o}},[]),s=document.createElement("div"),a=new t(s,{title:`מפה: ${this.currentLocation.name}`,size:"large",onClose:()=>{s.remove()}}),n=this.currentLocation.coords,i=`
                <div class="location-map-container">
                    <div class="map-info">
                        <strong>${this.currentLocation.name}</strong><br>
                        <small>${this.currentLocation.address}</small>
                    </div>
                    <div class="map-iframe-container">
                        <iframe 
                            src="https://www.openstreetmap.org/export/embed.html?bbox=${n.lng-.01},${n.lat-.01},${n.lng+.01},${n.lat+.01}&layer=mapnik&marker=${n.lat},${n.lng}"
                            class="location-map-iframe"
                            frameborder="0"
                            scrolling="no">
                        </iframe>
                    </div>
                    <div class="map-actions">
                        <a href="https://www.google.com/maps?q=${n.lat},${n.lng}" 
                           target="_blank" 
                           class="btn-secondary">
                            🗺️ פתח ב-Google Maps
                        </a>
                        <a href="https://www.openstreetmap.org/?mlat=${n.lat}&mlon=${n.lng}&zoom=16" 
                           target="_blank" 
                           class="btn-ghost">
                            🌐 פתח ב-OpenStreetMap
                        </a>
                    </div>
                </div>
            `;a.setContent(i),a.open(),document.body.appendChild(s)}catch(t){console.error("Failed to show map:",t),this.showErrorMessage("שגיאה בהצגת המפה")}}initializeTransactionSplitting(){var l,c;const e=this.container.querySelector("#splitTransaction"),t=this.container.querySelector(".split-container"),s=this.container.querySelector(".add-split-item"),a=this.container.querySelector(".auto-split-btn"),n=this.container.querySelector(".percentage-split-btn"),i=this.container.querySelector(".clear-splits-btn");this.splitItems=((c=(l=this.options.transaction)==null?void 0:l.split)==null?void 0:c.items)||[],e.addEventListener("change",()=>{t.style.display=e.checked?"block":"none",e.checked&&this.splitItems.length===0?this.addSplitItem():e.checked||this.clearSplitItems(),this.updateSplitDisplay()}),s.addEventListener("click",()=>{this.addSplitItem()}),a.addEventListener("click",()=>{this.autoSplitEvenly()}),n.addEventListener("click",()=>{this.showPercentageSplitDialog()}),i.addEventListener("click",()=>{this.clearSplitItems()}),this.updateSplitDisplay(),this.container.querySelector("#amount").addEventListener("input",()=>{this.updateSplitTotals()})}addSplitItem(e=null){const t=this.generateId(),s=e||{id:t,category:"",amount:0,description:"",percentage:0};this.splitItems.push(s),this.updateSplitDisplay(),setTimeout(()=>{const a=this.container.querySelector(`[data-split-id="${t}"] .split-category`);a&&a.focus()},100)}removeSplitItem(e){this.splitItems=this.splitItems.filter(t=>t.id!==e),this.updateSplitDisplay()}updateSplitDisplay(){const e=this.container.querySelector(".split-items-list");if(parseFloat(this.container.querySelector("#amount").value),this.splitItems.length===0){e.innerHTML='<div class="no-splits">אין פיצולים - הוסף פיצול ראשון</div>',this.updateSplitTotals();return}e.innerHTML=this.splitItems.map((t,s)=>this.createSplitItemHTML(t,s)).join(""),this.splitItems.forEach((t,s)=>{this.bindSplitItemEvents(t.id,s)}),this.loadCategoriesForSplits(),this.updateSplitTotals()}createSplitItemHTML(e,t){return`
            <div class="split-item" data-split-id="${e.id}">
                <div class="split-item-header">
                    <span class="split-item-number">#${t+1}</span>
                    <button type="button" class="btn-error btn-xs remove-split" data-split-id="${e.id}" title="הסר פיצול">
                        🗑️
                    </button>
                </div>
                
                <div class="split-item-content">
                    <div class="split-row">
                        <div class="split-field">
                            <label class="split-label">קטגוריה</label>
                            <select class="form-input split-category" data-split-id="${e.id}">
                                <option value="">בחר קטגוריה...</option>
                            </select>
                        </div>
                        
                        <div class="split-field split-amount-field">
                            <label class="split-label">סכום</label>
                            <div class="split-amount-container">
                                <input type="number" 
                                       class="form-input split-amount" 
                                       data-split-id="${e.id}"
                                       placeholder="0.00" 
                                       step="0.01" 
                                       min="0"
                                       value="${e.amount||""}">
                                <span class="currency-symbol">₪</span>
                            </div>
                        </div>
                        
                        <div class="split-field split-percentage-field">
                            <label class="split-label">אחוז</label>
                            <div class="split-percentage-container">
                                <input type="number" 
                                       class="form-input split-percentage" 
                                       data-split-id="${e.id}"
                                       placeholder="0" 
                                       step="0.1" 
                                       min="0" 
                                       max="100"
                                       value="${e.percentage||""}">
                                <span class="percentage-symbol">%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="split-row">
                        <div class="split-field split-description-field">
                            <label class="split-label">תיאור (אופציונלי)</label>
                            <input type="text" 
                                   class="form-input split-description" 
                                   data-split-id="${e.id}"
                                   placeholder="תיאור הפיצול..."
                                   value="${e.description||""}">
                        </div>
                    </div>
                </div>
            </div>
        `}bindSplitItemEvents(e,t){const s=this.container.querySelector(`[data-split-id="${e}"]`);s.querySelector(".remove-split").addEventListener("click",()=>{this.removeSplitItem(e)}),s.querySelector(".split-amount").addEventListener("input",c=>{this.updateSplitItemAmount(e,parseFloat(c.target.value)||0)}),s.querySelector(".split-percentage").addEventListener("input",c=>{this.updateSplitItemPercentage(e,parseFloat(c.target.value)||0)}),s.querySelector(".split-category").addEventListener("change",c=>{this.updateSplitItemCategory(e,c.target.value)}),s.querySelector(".split-description").addEventListener("input",c=>{this.updateSplitItemDescription(e,c.target.value)})}updateSplitItemAmount(e,t){const s=this.splitItems.find(a=>a.id===e);if(s){s.amount=t;const a=parseFloat(this.container.querySelector("#amount").value)||0;if(a>0){s.percentage=t/a*100;const n=this.container.querySelector(`[data-split-id="${e}"] .split-percentage`);n.value=s.percentage.toFixed(1)}this.updateSplitTotals()}}updateSplitItemPercentage(e,t){const s=this.splitItems.find(a=>a.id===e);if(s){s.percentage=t;const a=parseFloat(this.container.querySelector("#amount").value)||0;s.amount=a*t/100;const n=this.container.querySelector(`[data-split-id="${e}"] .split-amount`);n.value=s.amount.toFixed(2),this.updateSplitTotals()}}updateSplitItemCategory(e,t){const s=this.splitItems.find(a=>a.id===e);s&&(s.category=t)}updateSplitItemDescription(e,t){const s=this.splitItems.find(a=>a.id===e);s&&(s.description=t)}updateSplitTotals(){const e=parseFloat(this.container.querySelector("#amount").value)||0,t=this.splitItems.reduce((l,c)=>l+(c.amount||0),0),s=e-t,a=this.container.querySelector(".split-total-amount"),n=this.container.querySelector(".remaining-amount"),i=this.container.querySelector(".remaining-value"),o=this.container.querySelector(".validation-message");if(a&&(a.textContent=this.formatCurrency(e)),n&&i&&(i.textContent=this.formatCurrency(s),Math.abs(s)>.01?(n.style.display="inline",n.className=`remaining-amount ${s>0?"positive":"negative"}`):n.style.display="none"),o)if(Math.abs(s)>.01&&this.splitItems.length>0){const l=s>0?`⚠️ יתרת ${this.formatCurrency(s)} לא חולקה`:`⚠️ חריגה של ${this.formatCurrency(Math.abs(s))} מהסכום הכולל`;o.textContent=l,o.style.display="block",o.className="validation-message warning"}else this.splitItems.length>0?(o.textContent="✅ הפיצול מאוזן בהצלחה",o.style.display="block",o.className="validation-message success"):o.style.display="none"}async loadCategoriesForSplits(){var e;try{const{DataManager:t}=await S(async()=>{const{DataManager:i}=await Promise.resolve().then(()=>F);return{DataManager:i}},void 0),s=await t.getCategories(),a=((e=this.container.querySelector('input[name="type"]:checked'))==null?void 0:e.value)||"expense",n=s.filter(i=>i.type===a);this.splitItems.forEach(i=>{const o=this.container.querySelector(`[data-split-id="${i.id}"] .split-category`);if(o){const l=i.category;o.innerHTML='<option value="">בחר קטגוריה...</option>',n.forEach(c=>{const u=document.createElement("option");u.value=c.id,u.textContent=c.name,c.id===l&&(u.selected=!0),o.appendChild(u)})}})}catch(t){console.error("Failed to load categories for splits:",t)}}autoSplitEvenly(){const e=parseFloat(this.container.querySelector("#amount").value)||0;if(e<=0||this.splitItems.length===0){this.showErrorMessage("נדרש סכום חיובי ולפחות פיצול אחד");return}const t=e/this.splitItems.length,s=100/this.splitItems.length;this.splitItems.forEach((a,n)=>{a.amount=t,a.percentage=s;const i=this.container.querySelector(`[data-split-id="${a.id}"] .split-amount`),o=this.container.querySelector(`[data-split-id="${a.id}"] .split-percentage`);i&&(i.value=t.toFixed(2)),o&&(o.value=s.toFixed(1))}),this.updateSplitTotals(),this.showSuccessMessage("פיצול שווה בוצע בהצלחה")}async showPercentageSplitDialog(){try{const{Modal:e}=await S(async()=>{const{Modal:i}=await import("./Modal-CiVLbcbL.js");return{Modal:i}},[]),t=document.createElement("div"),s=new e(t,{title:"פיצול לפי אחוזים",size:"medium",onClose:()=>{t.remove()}}),a=`
                <div class="percentage-split-dialog">
                    <div class="dialog-explanation">
                        <p>הזן אחוזים עבור כל פיצול. הסכום יחושב אוטומטית.</p>
                        <small>סה"כ אחוזים צריכים להגיע ל-100%</small>
                    </div>
                    
                    <div class="percentage-inputs">
                        ${this.splitItems.map((i,o)=>`
                            <div class="percentage-input-row">
                                <label>פיצול #${o+1}:</label>
                                <div class="percentage-input-container">
                                    <input type="number" 
                                           class="form-input percentage-dialog-input" 
                                           data-split-id="${i.id}"
                                           placeholder="0" 
                                           step="0.1" 
                                           min="0" 
                                           max="100"
                                           value="${i.percentage||""}">
                                    <span class="percentage-symbol">%</span>
                                </div>
                            </div>
                        `).join("")}
                    </div>
                    
                    <div class="percentage-total">
                        <strong>סה"כ: <span class="total-percentage">0</span>%</strong>
                    </div>
                    
                    <div class="dialog-actions">
                        <button type="button" class="btn-primary apply-percentages">החל אחוזים</button>
                        <button type="button" class="btn-secondary cancel-percentages">ביטול</button>
                    </div>
                </div>
            `;s.setContent(a),s.open(),document.body.appendChild(t);const n=()=>{const i=t.querySelectorAll(".percentage-dialog-input"),o=Array.from(i).reduce((l,c)=>l+(parseFloat(c.value)||0),0);t.querySelector(".total-percentage").textContent=o.toFixed(1)};t.querySelectorAll(".percentage-dialog-input").forEach(i=>{i.addEventListener("input",n)}),t.querySelector(".apply-percentages").addEventListener("click",()=>{this.applyPercentageSplit(t),s.close()}),t.querySelector(".cancel-percentages").addEventListener("click",()=>{s.close()}),n()}catch(e){console.error("Failed to show percentage split dialog:",e),this.showErrorMessage("שגיאה בהצגת דיאלוג הפיצול")}}applyPercentageSplit(e){const t=e.querySelectorAll(".percentage-dialog-input");parseFloat(this.container.querySelector("#amount").value),t.forEach(s=>{const a=s.dataset.splitId,n=parseFloat(s.value)||0;this.updateSplitItemPercentage(a,n)}),this.updateSplitDisplay(),this.showSuccessMessage("פיצול אחוזי הוחל בהצלחה")}clearSplitItems(){this.splitItems=[],this.updateSplitDisplay()}validateSplits(){if(!this.container.querySelector("#splitTransaction").checked)return{isValid:!0,errors:[]};const e=[],t=parseFloat(this.container.querySelector("#amount").value)||0,s=this.splitItems.reduce((n,i)=>n+(i.amount||0),0);this.splitItems.length===0&&e.push("נדרש לפחות פיצול אחד כאשר הפיצול מופעל");const a=this.splitItems.filter(n=>!n.category);return a.length>0&&e.push(`${a.length} פיצולים חסרי קטגוריה`),Math.abs(t-s)>.01&&e.push("סכום הפיצולים לא תואם לסכום הכולל"),{isValid:e.length===0,errors:e}}async viewReceipt(e){const t=this.receiptFiles.find(s=>s.id===e);if(t)try{const{Modal:s}=await S(async()=>{const{Modal:o}=await import("./Modal-CiVLbcbL.js");return{Modal:o}},[]),a=document.createElement("div"),n=new s(a,{title:t.name,size:"large",onClose:()=>{a.remove()}}),i=t.type.startsWith("image/")?`<div class="receipt-full-view">
                    <img src="${t.data}" alt="${t.name}" class="receipt-full-image">
                </div>`:`<div class="receipt-pdf-view">
                    <iframe src="${t.data}" class="receipt-pdf-iframe"></iframe>
                </div>`;n.setContent(i),n.open(),document.body.appendChild(a)}catch(s){console.error("Failed to view receipt:",s),this.showErrorMessage("שגיאה בהצגת התמונה")}}truncateText(e,t){return e.length>t?e.substring(0,t)+"...":e}bindEvents(){this.formElement.addEventListener("submit",l=>{l.preventDefault(),this.handleSubmit()}),this.container.querySelectorAll('[data-action="cancel"]').forEach(l=>{l.addEventListener("click",()=>this.handleCancel())});const e=this.container.querySelector('[data-action="delete"]');e&&e.addEventListener("click",()=>this.handleDelete()),this.container.querySelectorAll('input[name="type"]').forEach(l=>{l.addEventListener("change",()=>this.handleTypeChange())});const t=this.container.querySelector("#isRecurring"),s=this.container.querySelector(".recurring-options"),a=this.container.querySelector("#recurringFrequency"),n=this.container.querySelector("#recurringEndDate"),i=this.container.querySelector("#recurringCount");t.addEventListener("change",()=>{s.style.display=t.checked?"block":"none",this.updateRecurringPreview()}),[a,n,i].forEach(l=>{l.addEventListener("change",()=>this.updateRecurringPreview()),l.addEventListener("input",()=>this.updateRecurringPreview())}),this.updateRecurringPreview(),this.container.querySelector(".add-category-btn").addEventListener("click",()=>this.showAddCategoryDialog())}handleTypeChange(){this.loadCategories()}async handleSubmit(){var s,a;const e=new FormData(this.formElement),t={id:((s=this.options.transaction)==null?void 0:s.id)||this.generateId(),type:e.get("type"),amount:parseFloat(e.get("amount")),description:e.get("description"),category:e.get("category"),account:e.get("account"),date:e.get("date"),tags:this.selectedTags||[],notes:e.get("notes"),receipts:this.receiptFiles||[],location:this.currentLocation||null,split:this.container.querySelector("#splitTransaction").checked?{enabled:!0,items:this.splitItems||[]}:{enabled:!1,items:[]},status:e.get("transactionStatus")||"ממתין",approver:e.get("approver"),approvalDate:e.get("approvalDate"),approvalNotes:e.get("approvalNotes"),isRecurring:e.has("isRecurring"),recurringFrequency:e.get("recurringFrequency"),recurringEndDate:e.get("recurringEndDate"),recurringCount:e.get("recurringCount")?parseInt(e.get("recurringCount")):null,createdAt:((a=this.options.transaction)==null?void 0:a.createdAt)||new Date().toISOString(),updatedAt:new Date().toISOString()};try{const{DataManager:n}=await S(async()=>{const{DataManager:i}=await Promise.resolve().then(()=>F);return{DataManager:i}},void 0);this.options.mode==="edit"?await n.updateTransaction(t.id,t):await n.addTransaction(t),this.options.onSave&&this.options.onSave(t),this.showSuccessMessage()}catch(n){console.error("Failed to save transaction:",n),this.showErrorMessage("שגיאה בשמירת העסקה")}}handleCancel(){this.options.onCancel&&this.options.onCancel()}async handleDelete(){if(confirm("האם אתה בטוח שברצונך למחוק את העסקה?"))try{const{DataManager:e}=await S(async()=>{const{DataManager:t}=await Promise.resolve().then(()=>F);return{DataManager:t}},void 0);await e.deleteTransaction(this.options.transaction.id),this.options.onSave&&this.options.onSave(null,"deleted"),this.showSuccessMessage()}catch(e){console.error("Failed to delete transaction:",e),this.showErrorMessage("שגיאה במחיקת העסקה")}}async showAddCategoryDialog(){try{typeof CategoryManager>"u"&&await S(()=>Promise.resolve().then(()=>_e),void 0);const{Modal:e}=await S(async()=>{const{Modal:i}=await import("./Modal-CiVLbcbL.js");return{Modal:i}},[]),t=document.createElement("div"),s=new e(t,{title:"ניהול קטגוריות",size:"large",onClose:()=>{t.remove(),this.loadCategories()}}),a=document.createElement("div"),n=new CategoryManager(a,{mode:"manage",allowAdd:!0,allowEdit:!0,allowDelete:!0,onAdd:i=>{this.showSuccessMessage(`קטגוריה "${i.name}" נוספה בהצלחה`)},onEdit:i=>{this.showSuccessMessage(`קטגוריה "${i.name}" עודכנה בהצלחה`)},onDelete:i=>{this.showSuccessMessage(`קטגוריה "${i.name}" נמחקה בהצלחה`)}});s.setContent(a),s.open(),document.body.appendChild(t)}catch(e){console.error("Failed to load category manager:",e),this.showErrorMessage("שגיאה בטעינת מנהל הקטגוריות")}}generateId(){return"tx_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}formatCurrency(e){return new Intl.NumberFormat("he-IL",{style:"currency",currency:"ILS",minimumFractionDigits:2}).format(e)}showSuccessMessage(){window.showToast&&window.showToast("העסקה נשמרה בהצלחה","success")}showErrorMessage(e){window.showToast&&window.showToast(e,"error")}getFormData(){const e=new FormData(this.formElement);return{type:e.get("type"),amount:parseFloat(e.get("amount")),description:e.get("description"),category:e.get("category"),account:e.get("account"),date:e.get("date"),tags:this.selectedTags||[],notes:e.get("notes"),isRecurring:e.has("isRecurring"),recurringFrequency:e.get("recurringFrequency"),recurringEndDate:e.get("recurringEndDate"),recurringCount:e.get("recurringCount")?parseInt(e.get("recurringCount")):null}}updateRecurringPreview(){const e=this.container.querySelector("#isRecurring").checked,t=this.container.querySelector(".recurring-preview-text");if(!e||!t){t&&(t.textContent="");return}const s=this.container.querySelector("#recurringFrequency").value,a=this.container.querySelector("#recurringEndDate").value,n=this.container.querySelector("#recurringCount").value,i=this.container.querySelector("#date").value;let l=`העסקה תחזור כל ${{weekly:"שבוע",biweekly:"שבועיים",monthly:"חודש",quarterly:"3 חודשים",yearly:"שנה"}[s]}`;if(i){const c=this.calculateNextOccurrence(i,s);l+=`. מועד הבא: ${this.formatHebrewDate(c)}`}n?l+=`. סה"כ ${n} פעמים`:a?l+=`. עד ${this.formatHebrewDate(a)}`:l+=". ללא הגבלת זמן",t.textContent=l}calculateNextOccurrence(e,t){const s=new Date(e);switch(t){case"weekly":s.setDate(s.getDate()+7);break;case"biweekly":s.setDate(s.getDate()+14);break;case"monthly":s.setMonth(s.getMonth()+1);break;case"quarterly":s.setMonth(s.getMonth()+3);break;case"yearly":s.setFullYear(s.getFullYear()+1);break}return s.toISOString().split("T")[0]}formatHebrewDate(e){return new Date(e).toLocaleDateString("he-IL",{day:"numeric",month:"long",year:"numeric"})}validateForm(){var a;const e=this.getFormData(),t=[];(!e.amount||e.amount<=0)&&t.push("נדרש סכום חיובי"),(a=e.description)!=null&&a.trim()||t.push("נדרש תיאור"),e.category||t.push("נדרשת קטגוריה"),e.account||t.push("נדרש חשבון"),e.date||t.push("נדרש תאריך");const s=this.validateSplits();return s.isValid||t.push(...s.errors),{isValid:t.length===0,errors:t}}}U.createQuickForm=function(r,e={}){const t={...e,mode:"add",showQuickActions:!0};return new U(r,t)};let R=class{constructor(e,t={}){this.container=e,this.options={mode:"manage",allowAdd:!0,allowEdit:!0,allowDelete:!0,multiSelect:!1,selectedCategories:[],onSelect:null,onAdd:null,onEdit:null,onDelete:null,...t},this.categories=[],this.filteredCategories=[],this.searchTerm="",this.activeFilter="all",this.init()}async init(){await this.loadCategories(),this.render(),this.bindEvents()}async loadCategories(){try{const{DataManager:e}=await S(async()=>{const{DataManager:t}=await Promise.resolve().then(()=>F);return{DataManager:t}},void 0);this.categories=await e.getCategories(),this.applyFilters()}catch(e){console.error("Failed to load categories:",e),this.categories=[]}}render(){this.options.mode;const e=this.options.mode==="add";this.container.innerHTML=`
            <div class="category-manager">
                ${e?"":this.renderHeader()}
                ${e?"":this.renderSearch()}
                ${e?"":this.renderFilters()}
                ${e?this.renderAddForm():this.renderCategoryList()}
                ${this.options.allowAdd&&!e?this.renderAddButton():""}
            </div>
        `}renderHeader(){return`
            <div class="category-header">
                <h3 class="category-title">${this.options.mode==="select"?"בחר קטגוריה":"ניהול קטגוריות"}</h3>
                <div class="category-stats">
                    <span class="stat-item">
                        <span class="stat-number">${this.categories.filter(s=>s.type==="expense").length}</span>
                        <span class="stat-label">הוצאות</span>
                    </span>
                    <span class="stat-item">
                        <span class="stat-number">${this.categories.filter(s=>s.type==="income").length}</span>
                        <span class="stat-label">הכנסות</span>
                    </span>
                </div>
            </div>
        `}renderSearch(){return`
            <div class="category-search">
                <div class="search-input-container">
                    <input type="text" id="categorySearch" class="search-input" 
                           placeholder="חפש קטגוריה..." value="${this.searchTerm}">
                    <span class="search-icon">🔍</span>
                </div>
            </div>
        `}renderFilters(){return`
            <div class="category-filters">
                <button class="filter-btn ${this.activeFilter==="all"?"active":""}" 
                        data-filter="all">הכל</button>
                <button class="filter-btn ${this.activeFilter==="expense"?"active":""}" 
                        data-filter="expense">הוצאות</button>
                <button class="filter-btn ${this.activeFilter==="income"?"active":""}" 
                        data-filter="income">הכנסות</button>
            </div>
        `}renderCategoryList(){const e=this.options.mode==="select";return this.filteredCategories.length===0?`
                <div class="category-empty">
                    <div class="empty-icon">📂</div>
                    <h4>אין קטגוריות להצגה</h4>
                    <p>לא נמצאו קטגוריות התואמות את החיפוש</p>
                </div>
            `:`
            <div class="category-list">
                ${this.filteredCategories.map(t=>this.renderCategoryItem(t,e)).join("")}
            </div>
        `}renderCategoryItem(e,t){const s=this.options.selectedCategories.includes(e.id),a=e.type==="expense"?"💸":"💰",n=e.type==="expense"?"הוצאה":"הכנסה";return`
            <div class="category-item ${s?"selected":""}" data-category-id="${e.id}">
                <div class="category-content">
                    <div class="category-icon">
                        ${e.icon||a}
                    </div>
                    <div class="category-info">
                        <div class="category-name">${e.name}</div>
                        <div class="category-meta">
                            <span class="category-type">${n}</span>
                            ${e.transactionCount?`<span class="transaction-count">${e.transactionCount} עסקאות</span>`:""}
                        </div>
                        ${e.description?`<div class="category-description">${e.description}</div>`:""}
                    </div>
                </div>
                <div class="category-actions">
                    ${t?`
                        <button class="btn-select ${s?"selected":""}" data-action="select">
                            ${s?"✓ נבחר":"בחר"}
                        </button>
                    `:`
                        ${this.options.allowEdit?`
                            <button class="btn-icon btn-edit" data-action="edit" title="ערוך">✏️</button>
                        `:""}
                        ${this.options.allowDelete?`
                            <button class="btn-icon btn-delete" data-action="delete" title="מחק">🗑️</button>
                        `:""}
                    `}
                </div>
            </div>
        `}renderAddButton(){return`
            <div class="category-add-section">
                <button class="btn-primary add-category-btn" data-action="add">
                    + הוסף קטגוריה חדשה
                </button>
            </div>
        `}renderAddForm(){return`
            <div class="category-form">
                <div class="form-header">
                    <h3>הוסף קטגוריה חדשה</h3>
                </div>
                
                <form id="categoryForm" class="category-form-content">
                    <div class="form-group">
                        <label for="categoryName" class="form-label required">שם הקטגוריה</label>
                        <input type="text" id="categoryName" name="name" class="form-input" 
                               placeholder="למשל: מזון, תחבורה, משכורת..." required>
                    </div>

                    <div class="form-group">
                        <label for="categoryType" class="form-label required">סוג</label>
                        <div class="type-selection">
                            <label class="type-option">
                                <input type="radio" name="type" value="expense" checked>
                                <span class="type-label">
                                    <span class="type-icon">💸</span>
                                    <span class="type-text">הוצאה</span>
                                </span>
                            </label>
                            <label class="type-option">
                                <input type="radio" name="type" value="income">
                                <span class="type-label">
                                    <span class="type-icon">💰</span>
                                    <span class="type-text">הכנסה</span>
                                </span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="categoryIcon" class="form-label">אייקון</label>
                        <div class="icon-selection">
                            <input type="text" id="categoryIcon" name="icon" class="form-input icon-input" 
                                   placeholder="בחר אייקון..." readonly>
                            <div class="icon-picker">
                                ${this.renderIconPicker()}
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="categoryDescription" class="form-label">תיאור</label>
                        <textarea id="categoryDescription" name="description" class="form-input form-textarea" 
                                  placeholder="תיאור אופציונלי לקטגוריה..." rows="3"></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-primary">שמור קטגוריה</button>
                        <button type="button" class="btn-secondary" data-action="cancel">ביטול</button>
                    </div>
                </form>
            </div>
        `}renderIconPicker(){const e=["💸","🛒","🏠","🚗","🍔","👕","⚡","📱","🏥","🎓","🎬","🎮"],t=["💰","💵","🏦","📈","💼","🎯","🏆","💎","🎁","📊","💳","🤝"];return`
            <div class="icon-category" data-type="expense">
                <h5>אייקוני הוצאות</h5>
                <div class="icon-grid">
                    ${e.map(s=>`
                        <button type="button" class="icon-option" data-icon="${s}">
                            ${s}
                        </button>
                    `).join("")}
                </div>
            </div>
            <div class="icon-category" data-type="income">
                <h5>אייקוני הכנסות</h5>
                <div class="icon-grid">
                    ${t.map(s=>`
                        <button type="button" class="icon-option" data-icon="${s}">
                            ${s}
                        </button>
                    `).join("")}
                </div>
            </div>
        `}bindEvents(){const e=this.container.querySelector("#categorySearch");e&&e.addEventListener("input",s=>{this.searchTerm=s.target.value,this.applyFilters(),this.updateCategoryList()}),this.container.querySelectorAll(".filter-btn").forEach(s=>{s.addEventListener("click",a=>{this.activeFilter=a.target.dataset.filter,this.applyFilters(),this.updateFilters(),this.updateCategoryList()})}),this.container.addEventListener("click",s=>{var o;const a=s.target.dataset.action,n=(o=s.target.closest(".category-item"))==null?void 0:o.dataset.categoryId,i=this.categories.find(l=>l.id===n);switch(a){case"select":this.handleSelect(i);break;case"edit":this.handleEdit(i);break;case"delete":this.handleDelete(i);break;case"add":this.showAddForm();break;case"cancel":this.handleCancel();break}});const t=this.container.querySelector("#categoryForm");t&&t.addEventListener("submit",s=>{s.preventDefault(),this.handleFormSubmit()}),this.container.querySelectorAll(".icon-option").forEach(s=>{s.addEventListener("click",a=>{const n=a.target.dataset.icon,i=this.container.querySelector("#categoryIcon");i&&(i.value=n),this.container.querySelectorAll(".icon-option").forEach(o=>o.classList.remove("selected")),a.target.classList.add("selected")})}),this.container.querySelectorAll('input[name="type"]').forEach(s=>{s.addEventListener("change",a=>{this.updateIconPicker(a.target.value)})})}updateIconPicker(e){this.container.querySelectorAll(".icon-category").forEach(t=>{const s=t.dataset.type;t.style.display=e==="expense"&&s==="expense"||e==="income"&&s==="income"?"block":"none"})}applyFilters(){let e=this.categories;if(this.searchTerm){const t=this.searchTerm.toLowerCase();e=e.filter(s=>s.name.toLowerCase().includes(t)||s.description&&s.description.toLowerCase().includes(t))}this.activeFilter!=="all"&&(e=e.filter(t=>t.type===this.activeFilter)),this.filteredCategories=e}updateCategoryList(){const e=this.container.querySelector(".category-list");if(e){const t=this.options.mode==="select";this.filteredCategories.length===0?e.innerHTML=`
                    <div class="category-empty">
                        <div class="empty-icon">📂</div>
                        <h4>אין קטגוריות להצגה</h4>
                        <p>לא נמצאו קטגוריות התואמות את החיפוש</p>
                    </div>
                `:e.innerHTML=this.filteredCategories.map(s=>this.renderCategoryItem(s,t)).join("")}}updateFilters(){this.container.querySelectorAll(".filter-btn").forEach(e=>{e.classList.toggle("active",e.dataset.filter===this.activeFilter)})}handleSelect(e){if(this.options.multiSelect){const t=this.options.selectedCategories.indexOf(e.id);t>-1?this.options.selectedCategories.splice(t,1):this.options.selectedCategories.push(e.id)}else this.options.selectedCategories=[e.id];this.updateCategoryList(),this.options.onSelect&&this.options.onSelect(e,this.options.selectedCategories)}handleEdit(e){this.options.onEdit?this.options.onEdit(e):this.showEditForm(e)}async handleDelete(e){if(confirm(`האם אתה בטוח שברצונך למחוק את הקטגוריה "${e.name}"?`))try{const{DataManager:t}=await S(async()=>{const{DataManager:s}=await Promise.resolve().then(()=>F);return{DataManager:s}},void 0);await t.deleteCategory(e.id),await this.loadCategories(),this.updateCategoryList(),this.options.onDelete&&this.options.onDelete(e),this.showSuccessMessage("הקטגוריה נמחקה בהצלחה")}catch(t){console.error("Failed to delete category:",t),this.showErrorMessage("שגיאה במחיקת הקטגוריה")}}showAddForm(){this.options.mode="add",this.render(),this.bindEvents()}showEditForm(e){this.options.mode="edit",this.editingCategory=e,this.render(),this.populateEditForm(e),this.bindEvents()}populateEditForm(e){const t=this.container.querySelector("#categoryForm");if(t){t.querySelector('[name="name"]').value=e.name,t.querySelector(`[name="type"][value="${e.type}"]`).checked=!0,t.querySelector('[name="icon"]').value=e.icon||"",t.querySelector('[name="description"]').value=e.description||"",this.updateIconPicker(e.type);const s=this.container.querySelector(".form-header h3");s&&(s.textContent="ערוך קטגוריה")}}async handleFormSubmit(){var a;const e=this.container.querySelector("#categoryForm"),t=new FormData(e),s={name:t.get("name"),type:t.get("type"),icon:t.get("icon"),description:t.get("description"),createdAt:((a=this.editingCategory)==null?void 0:a.createdAt)||new Date().toISOString(),updatedAt:new Date().toISOString()};try{const{DataManager:n}=await S(async()=>{const{DataManager:i}=await Promise.resolve().then(()=>F);return{DataManager:i}},void 0);this.editingCategory?(s.id=this.editingCategory.id,await n.updateCategory(s.id,s),this.showSuccessMessage("הקטגוריה עודכנה בהצלחה")):(s.id=this.generateId(),await n.addCategory(s),this.showSuccessMessage("הקטגוריה נוספה בהצלחה")),this.options.onAdd&&this.options.onAdd(s),await this.loadCategories(),this.handleCancel()}catch(n){console.error("Failed to save category:",n),this.showErrorMessage("שגיאה בשמירת הקטגוריה")}}handleCancel(){this.options.mode="manage",this.editingCategory=null,this.render(),this.bindEvents()}generateId(){return"cat_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}showSuccessMessage(e){window.showToast&&window.showToast(e,"success")}showErrorMessage(e){window.showToast&&window.showToast(e,"error")}getSelectedCategories(){return this.options.selectedCategories.map(e=>this.categories.find(t=>t.id===e)).filter(Boolean)}setSelectedCategories(e){this.options.selectedCategories=e,this.updateCategoryList()}refreshCategories(){return this.loadCategories().then(()=>{this.updateCategoryList()})}};R.createSelector=function(r,e={}){return new R(r,{...e,mode:"select",allowEdit:!1,allowDelete:!1})};R.createManager=function(r,e={}){return new R(r,{...e,mode:"manage"})};const _e=Object.freeze(Object.defineProperty({__proto__:null,CategoryManager:R},Symbol.toStringTag,{value:"Module"})),y={VERSION:"1.0.0",STORAGE_KEYS:{TRANSACTIONS:"pf_transactions",CATEGORIES:"pf_categories",BUDGETS:"pf_budgets",ACCOUNTS:"pf_accounts",SETTINGS:"pf_settings",TEMPLATES:"pf_templates",SCHEMA_VERSION:"pf_schema_version"},TRANSACTION:{id:"string",תאריך:"date",סכום:"number",תיאור:"string",קטגוריה:"string",חשבון:"string",סוג:"string",תת_קטגוריה:"string",הערות:"string",תגיות:"array",מיקום:"string",קבלה:"string",חוזר:"object",נוצר:"datetime",עודכן:"datetime",מקור:"string"},CATEGORY:{id:"string",שם:"string",צבע:"string",אייקון:"string",סוג:"string",הורה:"string",תקציב_חודשי:"number",אקטיבי:"boolean",נוצר:"datetime"},BUDGET:{id:"string",שם:"string",תקופה:"object",קטגוריות:"array",סכום_כולל:"number",הוצאו:"number",יעד:"string",התראות:"object",אקטיבי:"boolean",נוצר:"datetime"},ACCOUNT:{id:"string",שם:"string",סוג:"string",בנק:"string",מספר_חשבון:"string",יתרה:"number",מטבע:"string",צבע:"string",אקטיבי:"boolean",נוצר:"datetime"},SETTINGS:{שפה:"string",ערכת_נושא:"string",מטבע_ראשי:"string",פורמט_תאריך:"string",התראות:"object",גיבוי_אוטומטי:"boolean",הצפנה:"boolean",נוצר:"datetime",עודכן:"datetime"},TEMPLATE:{id:"string",name:"string",description:"string",type:"string",amount:"number",category:"string",frequency:"string",tags:"array",icon:"string",color:"string",isDefault:"boolean",createdAt:"datetime",updatedAt:"datetime"}},V={INCOME:[{id:"salary",שם:"משכורת",צבע:"#10B981",אייקון:"💼",סוג:"הכנסה"},{id:"freelance",שם:"עבודה עצמאית",צבע:"#8B5CF6",אייקון:"💻",סוג:"הכנסה"},{id:"investment",שם:"השקעות",צבע:"#F59E0B",אייקון:"📈",סוג:"הכנסה"},{id:"gift",שם:"מתנות",צבע:"#EF4444",אייקון:"🎁",סוג:"הכנסה"},{id:"other_income",שם:"הכנסות אחרות",צבע:"#6B7280",אייקון:"💰",סוג:"הכנסה"}],EXPENSES:[{id:"arnona",שם:"ארנונה",צבע:"#DC2626",אייקון:"🏠",סוג:"הוצאה"},{id:"bituach_leumi",שם:"ביטוח לאומי",צבע:"#7C2D12",אייקון:"🛡️",סוג:"הוצאה"},{id:"health_insurance",שם:"ביטוח בריאות",צבע:"#DC2626",אייקון:"⚕️",סוג:"הוצאה"},{id:"rent",שם:"שכר דירה",צבע:"#991B1B",אייקון:"🏠",סוג:"הוצאה"},{id:"electricity",שם:"חשמל",צבע:"#F59E0B",אייקון:"⚡",סוג:"הוצאה"},{id:"water",שם:"מים",צבע:"#3B82F6",אייקון:"💧",סוג:"הוצאה"},{id:"gas",שם:"גז",צבע:"#EF4444",אייקון:"🔥",סוג:"הוצאה"},{id:"internet",שם:"אינטרנט",צבע:"#8B5CF6",אייקון:"📡",סוג:"הוצאה"},{id:"phone",שם:"טלפון",צבע:"#06B6D4",אייקון:"📱",סוג:"הוצאה"},{id:"groceries",שם:"קניות מזון",צבע:"#10B981",אייקון:"🛒",סוג:"הוצאה"},{id:"restaurants",שם:"מסעדות",צבע:"#F97316",אייקון:"🍽️",סוג:"הוצאה"},{id:"transportation",שם:"תחבורה",צבע:"#3B82F6",אייקון:"🚗",סוג:"הוצאה"},{id:"fuel",שם:"דלק",צבע:"#DC2626",אייקון:"⛽",סוג:"הוצאה"},{id:"clothing",שם:"ביגוד",צבע:"#EC4899",אייקון:"👔",סוג:"הוצאה"},{id:"education",שם:"חינוך",צבע:"#8B5CF6",אייקון:"📚",סוג:"הוצאה"},{id:"healthcare",שם:"בריאות",צבע:"#EF4444",אייקון:"🏥",סוג:"הוצאה"},{id:"childcare",שם:"גן ילדים",צבע:"#F59E0B",אייקון:"🧸",סוג:"הוצאה"},{id:"entertainment",שם:"בילויים",צבע:"#8B5CF6",אייקון:"🎭",סוג:"הוצאה"},{id:"sports",שם:"ספורט",צבע:"#10B981",אייקון:"⚽",סוג:"הוצאה"},{id:"hobbies",שם:"תחביבים",צבע:"#F97316",אייקון:"🎨",סוג:"הוצאה"},{id:"other_expense",שם:"הוצאות אחרות",צבע:"#6B7280",אייקון:"📋",סוג:"הוצאה"}]},ce=["בנק הפועלים","בנק לאומי","בנק מזרחי טפחות","בנק דיסקונט","בנק יהב","הבנק הבינלאומי","בנק אוצר החייל","בנק ירושלים","בנק פועלי אגודת ישראל","מזומן"],w={currency:r=>new Intl.NumberFormat("he-IL",{style:"currency",currency:"ILS",minimumFractionDigits:2}).format(r),date:r=>new Date(r).toLocaleDateString("he-IL",{day:"2-digit",month:"2-digit",year:"numeric"}),number:r=>new Intl.NumberFormat("he-IL").format(r)};class Le{constructor(e={}){this.id=e.id||this.generateId(),this.תאריך=e.תאריך||new Date().toISOString().split("T")[0],this.סכום=parseFloat(e.סכום)||0,this.תיאור=e.תיאור||"",this.קטגוריה=e.קטגוריה||"",this.חשבון=e.חשבון||"",this.סוג=e.סוג||"הוצאה",this.תת_קטגוריה=e.תת_קטגוריה||"",this.הערות=e.הערות||"",this.תגיות=e.תגיות||[],this.מיקום=e.מיקום||"",this.קבלה=e.קבלה||"",this.חוזר=e.חוזר||null,this.סטטוס=e.סטטוס||"ממתין",this.מאשר=e.מאשר||"",this.תאריך_אישור=e.תאריך_אישור||null,this.הערות_אישור=e.הערות_אישור||"",this.נוצר=e.נוצר||new Date().toISOString(),this.עודכן=e.עודכן||new Date().toISOString(),this.מקור=e.מקור||"manual"}generateId(){return"txn_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}validate(){const e=[];return this.תיאור.trim()||e.push("תיאור העסקה נדרש"),this.סכום===0&&e.push("סכום העסקה חייב להיות שונה מאפס"),this.קטגוריה||e.push("יש לבחור קטגוריה"),this.חשבון||e.push("יש לבחור חשבון"),["הכנסה","הוצאה","העברה"].includes(this.סוג)||e.push("סוג עסקה לא תקין"),e}toDisplay(){return{...this,סכום_מעוצב:w.currency(Math.abs(this.סכום)),תאריך_מעוצב:w.date(this.תאריך),סכום_צבע:this.סכום>=0?"text-green-600":"text-red-600",סכום_עם_סימן:(this.סכום>=0?"+":"")+w.currency(this.סכום)}}touch(){this.עודכן=new Date().toISOString()}}class z{constructor(e={}){this.id=e.id||this.generateId(),this.שם=e.שם||"",this.צבע=e.צבע||"#6B7280",this.אייקון=e.אייקון||"📋",this.סוג=e.סוג||"הוצאה",this.הורה=e.הורה||null,this.תקציב_חודשי=parseFloat(e.תקציב_חודשי)||0,this.אקטיבי=e.אקטיבי!==void 0?e.אקטיבי:!0,this.נוצר=e.נוצר||new Date().toISOString()}generateId(){return"cat_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}validate(){const e=[];return this.שם.trim()||e.push("שם הקטגוריה נדרש"),["הכנסה","הוצאה"].includes(this.סוג)||e.push("סוג קטגוריה לא תקין"),this.תקציב_חודשי<0&&e.push("תקציב חודשי לא יכול להיות שלילי"),e}toDisplay(){return{...this,תקציב_מעוצב:this.תקציב_חודשי>0?w.currency(this.תקציב_חודשי):"ללא תקציב"}}}class Fe{constructor(e={}){this.id=e.id||this.generateId(),this.שם=e.שם||"",this.תקופה=e.תקופה||{start:new Date().toISOString().split("T")[0],end:new Date(Date.now()+30*24*60*60*1e3).toISOString().split("T")[0]},this.קטגוריות=e.קטגוריות||[],this.סכום_כולל=parseFloat(e.סכום_כולל)||0,this.הוצאו=parseFloat(e.הוצאו)||0,this.יעד=e.יעד||"",this.התראות=e.התראות||{threshold_50:!0,threshold_80:!0,threshold_100:!0},this.אקטיבי=e.אקטיבי!==void 0?e.אקטיבי:!0,this.נוצר=e.נוצר||new Date().toISOString()}generateId(){return"bdg_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}validate(){const e=[];return this.שם.trim()||e.push("שם התקציב נדרש"),this.סכום_כולל<=0&&e.push("סכום התקציב חייב להיות חיובי"),new Date(this.תקופה.start)>=new Date(this.תקופה.end)&&e.push("תאריך התחלה חייב להיות לפני תאריך הסיום"),e}getProgress(){const e=this.סכום_כולל>0?this.הוצאו/this.סכום_כולל*100:0,t=this.סכום_כולל-this.הוצאו;return{percentage:Math.round(e),remaining:t,status:e>100?"over":e>80?"warning":"ok",color:e>100?"red":e>80?"yellow":"green"}}toDisplay(){const e=this.getProgress();return{...this,סכום_כולל_מעוצב:w.currency(this.סכום_כולל),הוצאו_מעוצב:w.currency(this.הוצאו),נותר_מעוצב:w.currency(e.remaining),אחוז_ניצול:e.percentage,סטטוס:e.status,תקופה_מעוצבת:`${w.date(this.תקופה.start)} - ${w.date(this.תקופה.end)}`}}}class ee{constructor(e={}){this.id=e.id||this.generateId(),this.שם=e.שם||"",this.סוג=e.סוג||"בנק",this.בנק=e.בנק||"",this.מספר_חשבון=e.מספר_חשבון||"",this.יתרה=parseFloat(e.יתרה)||0,this.מטבע=e.מטבע||"ILS",this.צבע=e.צבע||"#3B82F6",this.אקטיבי=e.אקטיבי!==void 0?e.אקטיבי:!0,this.נוצר=e.נוצר||new Date().toISOString()}generateId(){return"acc_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}validate(){const e=[];return this.שם.trim()||e.push("שם החשבון נדרש"),["בנק","מזומן","אשראי","חיסכון"].includes(this.סוג)||e.push("סוג חשבון לא תקין"),this.סוג==="בנק"&&!this.בנק&&e.push("יש לבחור בנק"),this.מספר_חשבון&&this.מספר_חשבון.length<4&&e.push("מספר חשבון קצר מדי"),e}getMaskedAccountNumber(){if(!this.מספר_חשבון)return"";const e=this.מספר_חשבון.toString();return e.length>4?"*".repeat(e.length-4)+e.slice(-4):e}toDisplay(){return{...this,יתרה_מעוצבת:w.currency(this.יתרה),מספר_חשבון_מוסתר:this.getMaskedAccountNumber(),יתרה_צבע:this.יתרה>=0?"text-green-600":"text-red-600"}}}class Me{constructor(e={}){this.שפה=e.שפה||"he",this.ערכת_נושא=e.ערכת_נושא||"light",this.מטבע_ראשי=e.מטבע_ראשי||"ILS",this.פורמט_תאריך=e.פורמט_תאריך||"DD/MM/YYYY",this.התראות=e.התראות||{budget_alerts:!0,low_balance:!0,recurring_transactions:!0},this.גיבוי_אוטומטי=e.גיבוי_אוטומטי!==void 0?e.גיבוי_אוטומטי:!1,this.הצפנה=e.הצפנה!==void 0?e.הצפנה:!0,this.נוצר=e.נוצר||new Date().toISOString(),this.עודכן=e.עודכן||new Date().toISOString()}validate(){const e=[];return["he","en"].includes(this.שפה)||e.push("שפה לא נתמכת"),["light","dark","auto"].includes(this.ערכת_נושא)||e.push("ערכת נושא לא תקינה"),e}touch(){this.עודכן=new Date().toISOString()}}class f{static createTransaction(e){return new Le(e)}static createCategory(e){return new z(e)}static createBudget(e){return new Fe(e)}static createAccount(e){return new ee(e)}static createSettings(e){return new Me(e)}static createDefaultCategories(){const e=[];return V.INCOME.forEach(t=>{e.push(new z(t))}),V.EXPENSES.forEach(t=>{e.push(new z(t))}),e}static createDefaultAccount(){return new ee({שם:"מזומן",סוג:"מזומן",בנק:"מזומן",יתרה:0,צבע:"#10B981"})}}const I={STORAGE_NOT_AVAILABLE:"אחסון מקומי אינו זמין",INVALID_DATA:"נתונים לא תקינים",ITEM_NOT_FOUND:"פריט לא נמצא",VALIDATION_FAILED:"אימות נתונים נכשל",SAVE_FAILED:"שמירה נכשלה",DELETE_FAILED:"מחיקה נכשלה"};class ke{constructor(){this.isAvailable=this.checkStorageAvailability(),this.initializeSchema()}checkStorageAvailability(){try{const e="__storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return console.error("localStorage not available:",e),!1}}initializeSchema(){if(!this.isAvailable)return;const e=localStorage.getItem(y.STORAGE_KEYS.SCHEMA_VERSION);e?e!==y.VERSION&&this.migrateSchema(e,y.VERSION):(localStorage.setItem(y.STORAGE_KEYS.SCHEMA_VERSION,y.VERSION),this.initializeDefaultData())}initializeDefaultData(){try{const e=f.createDefaultCategories();this.saveMultiple("categories",e);const t=f.createDefaultAccount();this.save("accounts",t);const s=f.createSettings();this.save("settings",s),console.log("Default data initialized successfully")}catch(e){console.error("Failed to initialize default data:",e)}}save(e,t){if(!this.isAvailable)throw new Error(I.STORAGE_NOT_AVAILABLE);const s=this.getStorageKey(e),a=this.getAll(e);if(t.validate&&typeof t.validate=="function"){const n=t.validate();if(n.length>0)throw new Error(`${I.VALIDATION_FAILED}: ${n.join(", ")}`)}try{if(e!=="settings")if(a.find(i=>i.id===t.id)){const i=a.findIndex(o=>o.id===t.id);a[i]=t}else a.push(t);else return localStorage.setItem(s,JSON.stringify(t)),t;return localStorage.setItem(s,JSON.stringify(a)),t}catch(n){throw new Error(`${I.SAVE_FAILED}: ${n.message}`)}}saveMultiple(e,t){if(!Array.isArray(t))throw new Error(I.INVALID_DATA);const s=[];for(const a of t)s.push(this.save(e,a));return s}getById(e,t){if(e==="settings")return this.getSettings();const a=this.getAll(e).find(n=>n.id===t);if(!a)throw new Error(I.ITEM_NOT_FOUND);return this.createModelInstance(e,a)}getAll(e){if(!this.isAvailable)return[];const t=this.getStorageKey(e);try{const s=localStorage.getItem(t);if(!s)return[];const a=JSON.parse(s);return e==="settings"?this.createModelInstance(e,a):Array.isArray(a)?a.map(n=>this.createModelInstance(e,n)):[]}catch(s){return console.error(`Failed to load ${e}:`,s),[]}}getFiltered(e,t){return this.getAll(e).filter(t)}update(e,t,s){const a=this.getById(e,t);return Object.assign(a,s),a.touch&&typeof a.touch=="function"&&a.touch(),this.save(e,a)}delete(e,t){if(!this.isAvailable)throw new Error(I.STORAGE_NOT_AVAILABLE);if(e==="settings")throw new Error("לא ניתן למחוק הגדרות");const s=this.getStorageKey(e),a=this.getAll(e),n=a.findIndex(i=>i.id===t);if(n===-1)throw new Error(I.ITEM_NOT_FOUND);try{return a.splice(n,1),localStorage.setItem(s,JSON.stringify(a)),!0}catch(i){throw new Error(`${I.DELETE_FAILED}: ${i.message}`)}}deleteMultiple(e,t){const s=[];for(const a of t)try{s.push({id:a,success:this.delete(e,a)})}catch(n){s.push({id:a,success:!1,error:n.message})}return s}clear(e){if(!this.isAvailable)throw new Error(I.STORAGE_NOT_AVAILABLE);const t=this.getStorageKey(e);try{if(e==="settings"){const s=f.createSettings();localStorage.setItem(t,JSON.stringify(s))}else localStorage.setItem(t,JSON.stringify([]));return!0}catch(s){throw new Error(`${I.DELETE_FAILED}: ${s.message}`)}}clearAll(){Object.values(y.STORAGE_KEYS).forEach(e=>{try{localStorage.removeItem(e)}catch(t){console.error(`Failed to clear ${e}:`,t)}}),this.initializeSchema()}getStats(){return{transactions:this.getAll("transactions").length,categories:this.getAll("categories").length,budgets:this.getAll("budgets").length,accounts:this.getAll("accounts").length,storageUsed:this.getStorageUsage(),lastUpdate:new Date().toISOString()}}getStorageUsage(){let e=0;return Object.values(y.STORAGE_KEYS).forEach(t=>{const s=localStorage.getItem(t);s&&(e+=s.length)}),{bytes:e,kb:Math.round(e/1024),mb:Math.round(e/(1024*1024)*100)/100}}getStorageKey(e){return{transactions:y.STORAGE_KEYS.TRANSACTIONS,categories:y.STORAGE_KEYS.CATEGORIES,budgets:y.STORAGE_KEYS.BUDGETS,accounts:y.STORAGE_KEYS.ACCOUNTS,settings:y.STORAGE_KEYS.SETTINGS,templates:y.STORAGE_KEYS.TEMPLATES}[e]||e}createModelInstance(e,t){const a={transactions:f.createTransaction,categories:f.createCategory,budgets:f.createBudget,accounts:f.createAccount,settings:f.createSettings}[e];return a?a(t):t}getSettings(){const e=y.STORAGE_KEYS.SETTINGS,t=localStorage.getItem(e);if(!t){const s=f.createSettings();return this.save("settings",s),s}try{return f.createSettings(JSON.parse(t))}catch(s){return console.error("Failed to parse settings:",s),f.createSettings()}}updateSettings(e){const t=this.getSettings();return Object.assign(t,e),t.touch(),this.save("settings",t)}migrateSchema(e,t){console.log(`Schema migration needed: ${e} -> ${t}`),localStorage.setItem(y.STORAGE_KEYS.SCHEMA_VERSION,t)}}const p=new ke,d={transactions:{getAll:()=>p.getAll("transactions"),getById:r=>p.getById("transactions",r),save:r=>p.save("transactions",r),update:(r,e)=>p.update("transactions",r,e),delete:r=>p.delete("transactions",r),deleteMultiple:r=>p.deleteMultiple("transactions",r),getByDateRange:(r,e)=>p.getFiltered("transactions",t=>{const s=new Date(t.תאריך);return s>=new Date(r)&&s<=new Date(e)}),getByCategory:r=>p.getFiltered("transactions",e=>e.קטגוריה===r),getByAccount:r=>p.getFiltered("transactions",e=>e.חשבון===r)},categories:{getAll:()=>p.getAll("categories"),getById:r=>p.getById("categories",r),save:r=>p.save("categories",r),update:(r,e)=>p.update("categories",r,e),delete:r=>p.delete("categories",r),getByType:r=>p.getFiltered("categories",e=>e.סוג===r),getActive:()=>p.getFiltered("categories",r=>r.אקטיבי)},budgets:{getAll:()=>p.getAll("budgets"),getById:r=>p.getById("budgets",r),save:r=>p.save("budgets",r),update:(r,e)=>p.update("budgets",r,e),delete:r=>p.delete("budgets",r),getActive:()=>p.getFiltered("budgets",r=>r.אקטיבי),getCurrent:()=>{const r=new Date;return p.getFiltered("budgets",e=>{const t=new Date(e.תקופה.start),s=new Date(e.תקופה.end);return e.אקטיבי&&r>=t&&r<=s})}},accounts:{getAll:()=>p.getAll("accounts"),getById:r=>p.getById("accounts",r),save:r=>p.save("accounts",r),update:(r,e)=>p.update("accounts",r,e),delete:r=>p.delete("accounts",r),getActive:()=>p.getFiltered("accounts",r=>r.אקטיבי),updateBalance:(r,e)=>{const t=p.getById("accounts",r);return t.יתרה+=e,p.save("accounts",t)}},settings:{get:()=>p.getSettings(),update:r=>p.updateSettings(r)},templates:{getAll:()=>p.getAll("templates"),getById:r=>p.getById("templates",r),save:r=>p.save("templates",r),update:(r,e)=>p.update("templates",r,e),delete:r=>p.delete("templates",r),getByType:r=>p.getFiltered("templates",e=>e.type===r),getDefaults:()=>p.getFiltered("templates",r=>r.isDefault===!0),getCustom:()=>p.getFiltered("templates",r=>r.isDefault!==!0)},utils:{getStats:()=>p.getStats(),clearAll:()=>p.clearAll(),clear:r=>p.clear(r),isAvailable:()=>p.isAvailable}},g={REQUIRED:"שדה זה הוא חובה",REQUIRED_FIELD:r=>`${r} הוא שדה חובה`,MIN_LENGTH:r=>`נדרש לפחות ${r} תווים`,MAX_LENGTH:r=>`מקסימום ${r} תווים`,INVALID_TEXT:"טקסט לא תקין",INVALID_NUMBER:"מספר לא תקין",MIN_VALUE:r=>`הערך המינימלי הוא ${r}`,MAX_VALUE:r=>`הערך המקסימלי הוא ${r}`,POSITIVE_NUMBER:"המספר חייב להיות חיובי",NEGATIVE_NUMBER:"המספר חייב להיות שלילי",NON_ZERO:"הערך לא יכול להיות אפס",INVALID_DATE:"תאריך לא תקין",FUTURE_DATE:"התאריך לא יכול להיות בעתיד",PAST_DATE:"התאריך לא יכול להיות בעבר",DATE_RANGE:"תאריך ההתחלה חייב להיות לפני תאריך הסיום",INVALID_EMAIL:'כתובת דוא"ל לא תקינה',INVALID_PHONE:"מספר טלפון לא תקין",ISRAELI_PHONE_FORMAT:"פורמט: 05X-XXXXXXX או 0X-XXXXXXX",INVALID_ID:"תעודת זהות לא תקינה",ISRAELI_ID_FORMAT:"תעודת זהות חייבת להכיל 9 ספרות",INVALID_BANK_ACCOUNT:"מספר חשבון בנק לא תקין",BANK_ACCOUNT_LENGTH:"מספר חשבון בנק חייב להכיל 6-12 ספרות",INVALID_AMOUNT:"סכום לא תקין",CURRENCY_FORMAT:"פורמט: 1234.56 (ללא סימן מטבע)",INVALID_CATEGORY:"קטגוריה לא תקינה",CATEGORY_TYPE:"סוג קטגוריה חייב להיות הכנסה או הוצאה",BUDGET_PERIOD:"תקופת התקציב לא תקינה",BUDGET_AMOUNT:"סכום התקציב חייב להיות חיובי",ACCOUNT_TYPE:"סוג חשבון לא תקין",DUPLICATE_ACCOUNT:"חשבון עם פרטים דומים כבר קיים"};class T{static text(e,t={}){const s=[];return t.required&&(!e||e.trim()==="")?(s.push(t.fieldName?g.REQUIRED_FIELD(t.fieldName):g.REQUIRED),s):(e&&typeof e=="string"&&(t.minLength&&e.length<t.minLength&&s.push(g.MIN_LENGTH(t.minLength)),t.maxLength&&e.length>t.maxLength&&s.push(g.MAX_LENGTH(t.maxLength))),s)}static number(e,t={}){const s=[];if(t.required&&(e==null||e===""))return s.push(t.fieldName?g.REQUIRED_FIELD(t.fieldName):g.REQUIRED),s;if(e!=null&&e!==""){const a=parseFloat(e);if(isNaN(a))return s.push(g.INVALID_NUMBER),s;t.min!==void 0&&a<t.min&&s.push(g.MIN_VALUE(t.min)),t.max!==void 0&&a>t.max&&s.push(g.MAX_VALUE(t.max)),t.positive&&a<=0&&s.push(g.POSITIVE_NUMBER),t.negative&&a>=0&&s.push(g.NEGATIVE_NUMBER),t.nonZero&&a===0&&s.push(g.NON_ZERO)}return s}static date(e,t={}){const s=[];if(t.required&&!e)return s.push(t.fieldName?g.REQUIRED_FIELD(t.fieldName):g.REQUIRED),s;if(e){const a=new Date(e);if(isNaN(a.getTime()))return s.push(g.INVALID_DATE),s;const n=new Date;n.setHours(0,0,0,0),a.setHours(0,0,0,0),t.notFuture&&a>n&&s.push(g.FUTURE_DATE),t.notPast&&a<n&&s.push(g.PAST_DATE)}return s}static dateRange(e,t,s={}){const a=[],n=this.date(e,{required:!0,fieldName:"תאריך התחלה"}),i=this.date(t,{required:!0,fieldName:"תאריך סיום"});if(a.push(...n,...i),e&&t&&n.length===0&&i.length===0){const o=new Date(e),l=new Date(t);o>=l&&a.push(g.DATE_RANGE)}return a}static email(e,t={}){const s=[];return t.required&&!e?(s.push(g.REQUIRED),s):(e&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)||s.push(g.INVALID_EMAIL)),s)}static israeliPhone(e,t={}){const s=[];if(t.required&&!e)return s.push(g.REQUIRED),s;if(e){const a=e.replace(/\D/g,""),n=/^05[0-9]{8}$/,i=/^0[2-4,6-9][0-9]{7}$/;!n.test(a)&&!i.test(a)&&(s.push(g.INVALID_PHONE),s.push(g.ISRAELI_PHONE_FORMAT))}return s}static israeliId(e,t={}){const s=[];if(t.required&&!e)return s.push(g.REQUIRED),s;if(e){const a=e.replace(/\D/g,"");if(a.length!==9)return s.push(g.ISRAELI_ID_FORMAT),s;let n=0;for(let i=0;i<9;i++){let o=parseInt(a[i]);i%2===1&&(o*=2,o>9&&(o=Math.floor(o/10)+o%10)),n+=o}n%10!==0&&s.push(g.INVALID_ID)}return s}static bankAccount(e,t={}){const s=[];if(t.required&&!e)return s.push(g.REQUIRED),s;if(e){const a=e.replace(/\D/g,"");(a.length<6||a.length>12)&&s.push(g.BANK_ACCOUNT_LENGTH)}return s}static currency(e,t={}){const s=[],a=this.number(e,t);return s.push(...a),e&&a.length===0&&parseFloat(e)*100%1!==0&&s.push("מקסימום 2 מקומות עשרוניים"),s}}class $e{static validate(e){const t={},s=T.text(e.תיאור,{required:!0,fieldName:"תיאור",minLength:2,maxLength:200});s.length>0&&(t.תיאור=s);const a=T.currency(e.סכום,{required:!0,nonZero:!0,fieldName:"סכום"});a.length>0&&(t.סכום=a);const n=T.date(e.תאריך,{required:!0,fieldName:"תאריך"});return n.length>0&&(t.תאריך=n),e.קטגוריה||(t.קטגוריה=["יש לבחור קטגוריה"]),e.חשבון||(t.חשבון=["יש לבחור חשבון"]),["הכנסה","הוצאה","העברה"].includes(e.סוג)||(t.סוג=["סוג עסקה לא תקין"]),t}}class xe{static validate(e){const t={},s=T.text(e.שם,{required:!0,fieldName:"שם קטגוריה",minLength:2,maxLength:50});if(s.length>0&&(t.שם=s),["הכנסה","הוצאה"].includes(e.סוג)||(t.סוג=[g.CATEGORY_TYPE]),e.תקציב_חודשי!==void 0&&e.תקציב_חודשי!==null){const a=T.currency(e.תקציב_חודשי,{positive:!0,fieldName:"תקציב חודשי"});a.length>0&&(t.תקציב_חודשי=a)}return t}}class Re{static validate(e){var i,o;const t={},s=T.text(e.שם,{required:!0,fieldName:"שם תקציב",minLength:2,maxLength:100});s.length>0&&(t.שם=s);const a=T.currency(e.סכום_כולל,{required:!0,positive:!0,fieldName:"סכום תקציב"});a.length>0&&(t.סכום_כולל=a);const n=T.dateRange((i=e.תקופה)==null?void 0:i.start,(o=e.תקופה)==null?void 0:o.end);return n.length>0&&(t.תקופה=n),t}}class Ne{static validate(e){const t={},s=T.text(e.שם,{required:!0,fieldName:"שם חשבון",minLength:2,maxLength:100});if(s.length>0&&(t.שם=s),["בנק","מזומן","אשראי","חיסכון"].includes(e.סוג)||(t.סוג=[g.ACCOUNT_TYPE]),e.סוג==="בנק"&&!e.בנק&&(t.בנק=["יש לבחור בנק"]),e.מספר_חשבון){const n=T.bankAccount(e.מספר_חשבון,{required:e.סוג==="בנק"});n.length>0&&(t.מספר_חשבון=n)}const a=T.currency(e.יתרה,{fieldName:"יתרה"});return a.length>0&&(t.יתרה=a),t}}class v{static validateTransaction(e){return $e.validate(e)}static validateCategory(e){return xe.validate(e)}static validateBudget(e){return Re.validate(e)}static validateAccount(e){return Ne.validate(e)}static hasErrors(e){return Object.keys(e).length>0}static getErrorMessages(e){const t=[];return Object.values(e).forEach(s=>{Array.isArray(s)&&t.push(...s)}),t}static formatErrors(e){const t={};return Object.entries(e).forEach(([s,a])=>{t[s]=Array.isArray(a)?a.join(", "):a}),t}}class ${static exportFullBackup(){try{const e={timestamp:new Date().toISOString(),version:"1.0.0",data:{transactions:d.transactions.getAll(),categories:d.categories.getAll(),budgets:d.budgets.getAll(),accounts:d.accounts.getAll(),settings:d.settings.get()},stats:d.utils.getStats()};return{success:!0,data:JSON.stringify(e,null,2),filename:`finance-backup-${this.formatDateForFilename(new Date)}.json`,mimeType:"application/json"}}catch(e){return{success:!1,error:`שגיאה ביצוא גיבוי: ${e.message}`}}}static exportTransactionsCSV(e=null){try{let t=d.transactions.getAll();e&&e.start&&e.end&&(t=d.transactions.getByDateRange(e.start,e.end));const s=d.categories.getAll(),a=d.accounts.getAll(),n={};s.forEach(c=>n[c.id]=c.שם);const i={};a.forEach(c=>i[c.id]=c.שם);const o=t.map(c=>({תאריך:w.date(c.תאריך),תיאור:c.תיאור,סכום:c.סכום,קטגוריה:n[c.קטגוריה]||c.קטגוריה,חשבון:i[c.חשבון]||c.חשבון,"סוג עסקה":c.סוג,הערות:c.הערות||"",תגיות:Array.isArray(c.תגיות)?c.תגיות.join(";"):"",מיקום:c.מיקום||""}));return{success:!0,data:this.convertToCSV(o),filename:`transactions-${this.formatDateForFilename(new Date)}.csv`,mimeType:"text/csv;charset=utf-8"}}catch(t){return{success:!1,error:`שגיאה ביצוא עסקאות: ${t.message}`}}}static exportCategoriesCSV(){try{const t=d.categories.getAll().map(a=>({"שם קטגוריה":a.שם,סוג:a.סוג,"תקציב חודשי":a.תקציב_חודשי||0,צבע:a.צבע,אייקון:a.אייקון,פעיל:a.אקטיבי?"כן":"לא"}));return{success:!0,data:this.convertToCSV(t),filename:`categories-${this.formatDateForFilename(new Date)}.csv`,mimeType:"text/csv;charset=utf-8"}}catch(e){return{success:!1,error:`שגיאה ביצוא קטגוריות: ${e.message}`}}}static exportForBanks(e="generic"){try{const t=d.transactions.getAll(),s=d.categories.getAll(),a=d.accounts.getAll(),n={};s.forEach(c=>n[c.id]=c.שם);const i={};a.forEach(c=>i[c.id]=c.מספר_חשבון||c.שם);let o;switch(e){case"hapoalim":o=t.map(c=>({"תאריך פעולה":this.formatDateISR(c.תאריך),"תאריך ערך":this.formatDateISR(c.תאריך),"פרטי הפעולה":c.תיאור,אסמכתא:"",זכות:c.סכום>0?Math.abs(c.סכום):"",חובה:c.סכום<0?Math.abs(c.סכום):"",יתרה:""}));break;case"leumi":o=t.map(c=>({תאריך:this.formatDateISR(c.תאריך),תיאור:c.תיאור,קטגוריה:n[c.קטגוריה]||"",סכום:c.סכום,חשבון:i[c.חשבון]||""}));break;case"mizrahi":o=t.map(c=>({"תאריך פעולה":this.formatDateISR(c.תאריך),"תיאור פעולה":c.תיאור,"סכום זכות":c.סכום>0?c.סכום:"","סכום חובה":c.סכום<0?Math.abs(c.סכום):"",יתרה:"",הערות:c.הערות||""}));break;case"discount":o=t.map(c=>({תאריך:this.formatDateISR(c.תאריך),"פרטי פעולה":c.תיאור,"זכות/חובה":c.סכום>0?"זכות":"חובה",סכום:Math.abs(c.סכום),קטגוריה:n[c.קטגוריה]||""}));break;case"fibi":o=t.map(c=>({"תאריך ביצוע":this.formatDateISR(c.תאריך),תיאור:c.תיאור,סכום:c.סכום,"סוג תנועה":c.סכום>0?"זכות":"חובה",קטגוריה:n[c.קטגוריה]||""}));break;default:o=t.map(c=>({תאריך:this.formatDateISR(c.תאריך),"תיאור הפעולה":c.תיאור,סכום:c.סכום,"סוג פעולה":c.סכום>0?"זכות":"חובה",קטגוריה:n[c.קטגוריה]||"",הערות:c.הערות||""}))}return{success:!0,data:this.convertToCSV(o),filename:`bank-export-${e}-${this.formatDateForFilename(new Date)}.csv`,mimeType:"text/csv;charset=utf-8"}}catch(t){return{success:!1,error:`שגיאה ביצוא לבנק: ${t.message}`}}}static downloadFile(e){if(!e.success)throw new Error(e.error);try{const t=new Blob([e.data],{type:e.mimeType}),s=URL.createObjectURL(t),a=document.createElement("a");return a.href=s,a.download=e.filename,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s),!0}catch(t){throw new Error(`שגיאה בהורדת קובץ: ${t.message}`)}}static convertToCSV(e){if(!e||e.length===0)return"";const t=Object.keys(e[0]),s=[];return s.push(t.map(a=>`"${a}"`).join(",")),e.forEach(a=>{const n=t.map(i=>{const o=a[i];return`"${o??""}"`});s.push(n.join(","))}),s.join(`
`)}static formatDateForFilename(e){return e.toISOString().split("T")[0]}static formatDateISR(e){return new Date(e).toLocaleDateString("he-IL")}}class te{static async importFullBackup(e){try{const t=JSON.parse(e);if(!t.data||!t.version)throw new Error("פורמט גיבוי לא תקין");if(!$.exportFullBackup().success)throw new Error("נכשל ביצירת גיבוי נוכחי");const a={imported:0,errors:[],backed_up:!0};if(t.data.transactions)try{d.utils.clear("transactions"),t.data.transactions.forEach(n=>{d.transactions.save(n),a.imported++})}catch(n){a.errors.push(`עסקאות: ${n.message}`)}if(t.data.categories)try{d.utils.clear("categories"),t.data.categories.forEach(n=>{d.categories.save(n),a.imported++})}catch(n){a.errors.push(`קטגוריות: ${n.message}`)}if(t.data.budgets)try{d.utils.clear("budgets"),t.data.budgets.forEach(n=>{d.budgets.save(n),a.imported++})}catch(n){a.errors.push(`תקציבים: ${n.message}`)}if(t.data.accounts)try{d.utils.clear("accounts"),t.data.accounts.forEach(n=>{d.accounts.save(n),a.imported++})}catch(n){a.errors.push(`חשבונות: ${n.message}`)}if(t.data.settings)try{d.settings.update(t.data.settings),a.imported++}catch(n){a.errors.push(`הגדרות: ${n.message}`)}return{success:!0,results:a,message:`יובאו בהצלחה ${a.imported} פריטים`}}catch(t){return{success:!1,error:`שגיאה בייבוא גיבוי: ${t.message}`}}}static async importTransactionsCSV(e,t={}){try{const s=e.split(`
`).filter(u=>u.trim());if(s.length<2)throw new Error("קובץ CSV ריק או לא תקין");const a=this.parseCSVLine(s[0]),n={imported:0,skipped:0,errors:[]},i=d.categories.getAll(),o=d.accounts.getAll(),l={};i.forEach(u=>{l[u.שם]=u.id,l[u.id]=u.id});const c={};o.forEach(u=>{c[u.שם]=u.id,c[u.id]=u.id});for(let u=1;u<s.length;u++)try{const h=this.parseCSVLine(s[u]);if(h.length!==a.length){n.errors.push(`שורה ${u+1}: מספר עמודות לא תואם`),n.skipped++;continue}const E={};a.forEach((O,N)=>{E[O]=h[N]});const k=this.mapCSVToTransaction(E,l,c);k?(d.transactions.save(k),n.imported++):n.skipped++}catch(h){n.errors.push(`שורה ${u+1}: ${h.message}`),n.skipped++}return{success:!0,results:n,message:`יובאו ${n.imported} עסקאות, דולגו ${n.skipped}`}}catch(s){return{success:!1,error:`שגיאה בייבוא CSV: ${s.message}`}}}static mapCSVToTransaction(e,t,s){try{const a=["תאריך","date","תאריך פעולה","תאריך ערך","תאריך ביצוע","Date","Transaction Date","Value Date","Execution Date"],n=["תיאור","description","פרטי הפעולה","תיאור הפעולה","תיאור פעולה","פרטי פעולה","Description","Transaction Description","Details","Particulars"],i=["סכום","amount","זכות","חובה","סכום זכות","סכום חובה","Amount","Credit","Debit","Credit Amount","Debit Amount"],o=["קטגוריה","category","Category","Type","סוג"],l=["חשבון","account","Account","מספר חשבון","Account Number"],c={תאריך:this.findFieldValue(e,a),תיאור:this.findFieldValue(e,n),סכום:this.parseAmount(e,i),קטגוריה:this.mapCategory(e,o,t),חשבון:this.mapAccount(e,l,s),סוג:"הוצאה",הערות:e.הערות||e.notes||"",מקור:"import"};if(c.סכום>0?c.סוג="הכנסה":c.סכום<0&&(c.סוג="הוצאה"),!c.תאריך||!c.תיאור||c.סכום===0)throw new Error("שדות חובה חסרים");return c}catch(a){return console.error("Error mapping CSV row:",a),null}}static parseCSVLine(e){const t=[];let s="",a=!1;for(let n=0;n<e.length;n++){const i=e[n];i==='"'?a=!a:i===","&&!a?(t.push(s.trim()),s=""):s+=i}return t.push(s.trim()),t}static findFieldValue(e,t){for(const s of t)if(e[s]!==void 0&&e[s]!=="")return e[s];return""}static parseAmount(e,t){const s=["זכות","סכום זכות","Credit","Credit Amount"],a=["חובה","סכום חובה","Debit","Debit Amount"];let n=0,i=0;for(const o of s)if(e[o]!==void 0&&e[o]!==""){const l=parseFloat(e[o].toString().replace(/[^\d.-]/g,""));if(!isNaN(l)&&l>0){n=l;break}}for(const o of a)if(e[o]!==void 0&&e[o]!==""){const l=parseFloat(e[o].toString().replace(/[^\d.-]/g,""));if(!isNaN(l)&&l>0){i=-Math.abs(l);break}}if(n>0)return n;if(i<0)return i;for(const o of t)if(e[o]!==void 0&&e[o]!==""){let l=parseFloat(e[o].toString().replace(/[^\d.-]/g,""));if(!isNaN(l)){const c=e["זכות/חובה"]||e["סוג תנועה"]||e["סוג פעולה"];return c&&(c.includes("חובה")||c.includes("Debit")?l=-Math.abs(l):(c.includes("זכות")||c.includes("Credit"))&&(l=Math.abs(l))),l}}return 0}static mapCategory(e,t,s){const a=this.findFieldValue(e,t);return s[a]||null}static mapAccount(e,t,s){const a=this.findFieldValue(e,t);return s[a]||null}}const _={exportAll:()=>$.exportFullBackup(),exportTransactions:r=>$.exportTransactionsCSV(r),exportCategories:()=>$.exportCategoriesCSV(),exportForBank:r=>$.exportForBanks(r),importBackup:r=>te.importFullBackup(r),importTransactions:(r,e)=>te.importTransactionsCSV(r,e),download:r=>$.downloadFile(r),supportedFormats:{export:["json","csv"],bankFormats:["generic","hapoalim","leumi","mizrahi","discount","fibi"],import:["json","csv"]}};class qe{constructor(e=null){this.key=e||this.generateKey(),this.encoder=new TextEncoder,this.decoder=new TextDecoder}generateKey(){const e=navigator.userAgent,t=Date.now().toString(),s=Math.random().toString(36);return btoa(e+t+s).slice(0,32)}encrypt(e){if(!e)return e;try{const t=this.encoder.encode(e),s=this.encoder.encode(this.key),a=new Uint8Array(t.length);for(let n=0;n<t.length;n++)a[n]=t[n]^s[n%s.length];return btoa(String.fromCharCode(...a))}catch(t){return console.error("Encryption error:",t),e}}decrypt(e){if(!e)return e;try{const t=new Uint8Array(atob(e).split("").map(n=>n.charCodeAt(0))),s=this.encoder.encode(this.key),a=new Uint8Array(t.length);for(let n=0;n<t.length;n++)a[n]=t[n]^s[n%s.length];return this.decoder.decode(a)}catch(t){return console.error("Decryption error:",t),e}}}class Oe{constructor(){this.encryption=new qe,this.isEnabled=this.getEncryptionSetting(),this.sensitiveFields={accounts:["מספר_חשבון","יתרה"],transactions:["הערות"],settings:[]}}getEncryptionSetting(){try{return JSON.parse(localStorage.getItem("pf_settings")||"{}").הצפנה!==!1}catch{return!0}}setEncryptionEnabled(e){this.isEnabled=e;try{const t=JSON.parse(localStorage.getItem("pf_settings")||"{}");t.הצפנה=e,t.עודכן=new Date().toISOString(),localStorage.setItem("pf_settings",JSON.stringify(t))}catch(t){console.error("Failed to update encryption setting:",t)}}encryptData(e,t){if(!this.isEnabled||!e)return e;try{const s=this.sensitiveFields[t]||[];return Array.isArray(e)?e.map(a=>this.encryptObject(a,s)):this.encryptObject(e,s)}catch(s){return console.error("Data encryption error:",s),e}}decryptData(e,t){if(!this.isEnabled||!e)return e;try{const s=this.sensitiveFields[t]||[];return Array.isArray(e)?e.map(a=>this.decryptObject(a,s)):this.decryptObject(e,s)}catch(s){return console.error("Data decryption error:",s),e}}encryptObject(e,t){if(!e||typeof e!="object")return e;const s={...e};return t.forEach(a=>{s[a]!==void 0&&s[a]!==null&&(s[a]=this.encryption.encrypt(s[a].toString()))}),s}decryptObject(e,t){if(!e||typeof e!="object")return e;const s={...e};return t.forEach(a=>{if(s[a]!==void 0&&s[a]!==null){const n=this.encryption.decrypt(s[a]);if(a==="יתרה"||a==="מספר_חשבון"){const i=parseFloat(n);!isNaN(i)&&a==="יתרה"?s[a]=i:s[a]=n}else s[a]=n}}),s}secureDelete(e){try{const t=Array(1024).fill(0).map(()=>Math.random().toString(36)).join("");return localStorage.setItem(e,t),localStorage.removeItem(e),!0}catch(t){return console.error("Secure deletion error:",t),!1}}encryptExportData(e){if(!this.isEnabled)return e;try{return this.encryption.encrypt(JSON.stringify(e))}catch(t){return console.error("Export encryption error:",t),e}}decryptImportData(e){if(!this.isEnabled)return e;try{const t=this.encryption.decrypt(e);return JSON.parse(t)}catch(t){console.error("Import decryption error:",t);try{return JSON.parse(e)}catch{throw new Error("לא ניתן לפענח את הנתונים - ייתכן שהם לא מוצפנים או פגומים")}}}getEncryptionStatus(){return{enabled:this.isEnabled,keyGenerated:!!this.encryption.key,sensitiveFields:this.sensitiveFields,lastUpdate:new Date().toISOString(),message:this.isEnabled?"הצפנה פעילה - נתונים רגישים מוצפנים בזיכרון המקומי":"הצפנה לא פעילה - נתונים נשמרים בטקסט גלוי"}}async migrateEncryption(e){try{const t=["pf_transactions","pf_categories","pf_budgets","pf_accounts"],s={migrated:0,errors:[]};for(const a of t)try{const n=localStorage.getItem(a);if(!n)continue;const i=JSON.parse(n),o=a.replace("pf_","");let l;e?l=this.encryptData(i,o):l=this.decryptData(i,o),localStorage.setItem(a,JSON.stringify(l)),s.migrated++}catch(n){s.errors.push(`${a}: ${n.message}`)}return this.setEncryptionEnabled(e),{success:!0,results:s,message:e?`הוצפנו בהצלחה ${s.migrated} קבצי נתונים`:`בוטלה הצפנה עבור ${s.migrated} קבצי נתונים`}}catch(t){return{success:!1,error:`שגיאה במעבר הצפנה: ${t.message}`}}}}const A=new Oe,L={isEnabled:()=>A.isEnabled,enable:()=>A.migrateEncryption(!0),disable:()=>A.migrateEncryption(!1),encrypt:(r,e)=>A.encryptData(r,e),decrypt:(r,e)=>A.decryptData(r,e),encryptForExport:r=>A.encryptExportData(r),decryptFromImport:r=>A.decryptImportData(r),secureDelete:r=>A.secureDelete(r),getStatus:()=>A.getEncryptionStatus(),updateSetting:r=>A.setEncryptionEnabled(r)};class P{static normalizeHebrew(e){return!e||typeof e!="string"?"":e.replace(/[\u0591-\u05C7]/g,"").replace(/\s+/g," ").trim().toLowerCase()}static searchHebrewText(e,t){if(!e||!t)return!1;const s=this.normalizeHebrew(e),a=this.normalizeHebrew(t);if(s.includes(a))return!0;const n=s.split(" ");return a.split(" ").every(o=>n.some(l=>l.includes(o)))}static multiFieldSearch(e,t,s){return t?s.some(a=>{const n=e[a];return n==null?!1:this.searchHebrewText(n.toString(),t)}):!0}}class C{static filterTransactions(e={}){let t=d.transactions.getAll();return e.search&&(t=t.filter(s=>P.multiFieldSearch(s,e.search,["תיאור","הערות"]))),(e.dateFrom||e.dateTo)&&(t=t.filter(s=>{const a=new Date(s.תאריך);return!(e.dateFrom&&a<new Date(e.dateFrom)||e.dateTo&&a>new Date(e.dateTo))})),(e.amountMin!==void 0||e.amountMax!==void 0)&&(t=t.filter(s=>{const a=Math.abs(s.סכום);return!(e.amountMin!==void 0&&a<e.amountMin||e.amountMax!==void 0&&a>e.amountMax)})),e.categories&&e.categories.length>0&&(t=t.filter(s=>e.categories.includes(s.קטגוריה))),e.accounts&&e.accounts.length>0&&(t=t.filter(s=>e.accounts.includes(s.חשבון))),e.types&&e.types.length>0&&(t=t.filter(s=>e.types.includes(s.סוג))),e.tags&&e.tags.length>0&&(t=t.filter(s=>s.תגיות&&s.תגיות.some(a=>e.tags.includes(a)))),t}static filterCategories(e={}){let t=d.categories.getAll();return e.search&&(t=t.filter(s=>P.searchHebrewText(s.שם,e.search))),e.type&&(t=t.filter(s=>s.סוג===e.type)),e.active!==void 0&&(t=t.filter(s=>s.אקטיבי===e.active)),t}static filterAccounts(e={}){let t=d.accounts.getAll();return e.search&&(t=t.filter(s=>P.multiFieldSearch(s,e.search,["שם","בנק"]))),e.type&&(t=t.filter(s=>s.סוג===e.type)),e.active!==void 0&&(t=t.filter(s=>s.אקטיבי===e.active)),t}}class D{static calculateTotals(e=null){e||(e=d.transactions.getAll());const t={הכנסות:0,הוצאות:0,יתרה:0,מספר_עסקאות:e.length};return e.forEach(s=>{s.סוג==="הכנסה"||s.סכום>0?t.הכנסות+=Math.abs(s.סכום):(s.סוג==="הוצאה"||s.סכום<0)&&(t.הוצאות+=Math.abs(s.סכום))}),t.יתרה=t.הכנסות-t.הוצאות,t}static calculateByCategory(e=null){e||(e=d.transactions.getAll());const t=d.categories.getAll(),s={};return t.forEach(a=>{s[a.id]={id:a.id,שם:a.שם,צבע:a.צבע,אייקון:a.אייקון,סכום:0,מספר_עסקאות:0}}),e.forEach(a=>{s[a.קטגוריה]&&(s[a.קטגוריה].סכום+=Math.abs(a.סכום),s[a.קטגוריה].מספר_עסקאות++)}),Object.values(s).filter(a=>a.סכום>0).sort((a,n)=>n.סכום-a.סכום)}static calculateByAccount(e=null){e||(e=d.transactions.getAll());const t=d.accounts.getAll(),s={};return t.forEach(a=>{s[a.id]={id:a.id,שם:a.שם,סוג:a.סוג,צבע:a.צבע,סכום:0,מספר_עסקאות:0}}),e.forEach(a=>{s[a.חשבון]&&(s[a.חשבון].סכום+=Math.abs(a.סכום),s[a.חשבון].מספר_עסקאות++)}),Object.values(s).filter(a=>a.סכום>0).sort((a,n)=>n.סכום-a.סכום)}static calculateMonthlyTrends(e=12){const t=d.transactions.getAll(),s=new Date,a=[];for(let n=e-1;n>=0;n--){const i=new Date(s.getFullYear(),s.getMonth()-n,1),o=new Date(i.getFullYear(),i.getMonth(),1),l=new Date(i.getFullYear(),i.getMonth()+1,0),c=t.filter(h=>{const E=new Date(h.תאריך);return E>=o&&E<=l}),u=this.calculateTotals(c);a.push({חודש:i.toLocaleDateString("he-IL",{year:"numeric",month:"long"}),שנה:i.getFullYear(),מספר_חודש:i.getMonth()+1,...u})}return a}static calculateBudgetPerformance(){const e=d.budgets.getActive(),t=[];return e.forEach(s=>{const a=d.transactions.getByDateRange(s.תקופה.start,s.תקופה.end),n=a.filter(o=>o.סוג==="הוצאה").reduce((o,l)=>o+Math.abs(l.סכום),0),i=s.getProgress();i.spent=n,t.push({budget:s,progress:i,transactions:a.length})}),t}static calculateSavingsRate(e=30){const t=new Date,s=new Date(t.getTime()-e*24*60*60*1e3),a=d.transactions.getByDateRange(s.toISOString().split("T")[0],t.toISOString().split("T")[0]),n=this.calculateTotals(a),i=n.הכנסות>0?n.יתרה/n.הכנסות*100:0;return{תקופה:e,הכנסות:n.הכנסות,הוצאות:n.הוצאות,חיסכון:n.יתרה,שיעור_חיסכון:Math.round(i*100)/100,הערכה:i>20?"מעולה":i>10?"טוב":i>0?"בסיסי":"דורש שיפור"}}static calculateExpensePatterns(){const e=d.transactions.getAll().filter(i=>i.סוג==="הוצאה"),t=Array(7).fill(0),s=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"],a=Array(12).fill(0),n=["ינואר","פברואר","מרץ","אפריל","מאי","יוני","יולי","אוגוסט","ספטמבר","אוקטובר","נובמבר","דצמבר"];return e.forEach(i=>{const o=new Date(i.תאריך);t[o.getDay()]+=Math.abs(i.סכום),a[o.getMonth()]+=Math.abs(i.סכום)}),{יומי:t.map((i,o)=>({יום:s[o],סכום:i})),חודשי:a.map((i,o)=>({חודש:n[o],סכום:i}))}}static getTopSpendingCategories(e=5){return this.calculateByCategory().slice(0,e)}static getRecentTransactionsSummary(e=7){const t=new Date,s=new Date(t.getTime()-e*24*60*60*1e3),a=d.transactions.getByDateRange(s.toISOString().split("T")[0],t.toISOString().split("T")[0]),n=this.calculateTotals(a),i=this.calculateByCategory(a);return{תקופה:e,סיכום:n,קטגוריות:i.slice(0,5),עסקאות_אחרונות:a.sort((o,l)=>new Date(l.תאריך)-new Date(o.תאריך)).slice(0,10)}}}const q={search:{transactions:(r,e={})=>C.filterTransactions({search:r,...e}),categories:r=>C.filterCategories({search:r}),accounts:r=>C.filterAccounts({search:r}),all:r=>({transactions:C.filterTransactions({search:r}),categories:C.filterCategories({search:r}),accounts:C.filterAccounts({search:r})})},filter:{transactions:r=>C.filterTransactions(r),categories:r=>C.filterCategories(r),accounts:r=>C.filterAccounts(r)},analytics:{totals:r=>D.calculateTotals(r),byCategory:r=>D.calculateByCategory(r),byAccount:r=>D.calculateByAccount(r),monthlyTrends:r=>D.calculateMonthlyTrends(r),budgetPerformance:()=>D.calculateBudgetPerformance(),savingsRate:r=>D.calculateSavingsRate(r),expensePatterns:()=>D.calculateExpensePatterns(),topCategories:r=>D.getTopSpendingCategories(r),recentSummary:r=>D.getRecentTransactionsSummary(r)},utils:{normalizeHebrew:r=>P.normalizeHebrew(r)}},se={"1.0.0":{description:"Initial schema setup",up:()=>({success:!0,message:"סכמה ראשונית הוגדרה בהצלחה"})},"1.1.0":{description:"Add tags support to transactions",up:()=>{try{const r=d.transactions.getAll();let e=0;return r.forEach(t=>{t.תגיות||(t.תגיות=[],d.transactions.save(t),e++)}),{success:!0,message:`הוספו תגיות ל-${e} עסקאות`}}catch(r){return{success:!1,error:`שגיאה בהוספת תגיות: ${r.message}`}}}},"1.2.0":{description:"Add location field to transactions",up:()=>{try{const r=d.transactions.getAll();let e=0;return r.forEach(t=>{t.מיקום||(t.מיקום="",d.transactions.save(t),e++)}),{success:!0,message:`הוסף שדה מיקום ל-${e} עסקאות`}}catch(r){return{success:!1,error:`שגיאה בהוספת מיקום: ${r.message}`}}}}};class B{static getCurrentVersion(){return localStorage.getItem(y.STORAGE_KEYS.SCHEMA_VERSION)||"1.0.0"}static getTargetVersion(){return y.VERSION}static needsMigration(){const e=this.getCurrentVersion(),t=this.getTargetVersion();return this.compareVersions(e,t)<0}static compareVersions(e,t){const s=e.split(".").map(Number),a=t.split(".").map(Number);for(let n=0;n<Math.max(s.length,a.length);n++){const i=s[n]||0,o=a[n]||0;if(i<o)return-1;if(i>o)return 1}return 0}static async runMigrations(){if(!this.needsMigration())return{success:!0,message:"אין צורך בעדכון סכמה",currentVersion:this.getCurrentVersion()};const e=this.getCurrentVersion(),t=this.getTargetVersion(),s={success:!0,migrations:[],errors:[],fromVersion:e,toVersion:t};try{const a=`migration_backup_${Date.now()}`,n={transactions:d.transactions.getAll(),categories:d.categories.getAll(),budgets:d.budgets.getAll(),accounts:d.accounts.getAll(),settings:d.settings.get()};localStorage.setItem(a,JSON.stringify(n));const i=Object.keys(se).sort(this.compareVersions);for(const o of i)if(this.compareVersions(e,o)<0&&this.compareVersions(o,t)<=0){const l=se[o];console.log(`Running migration to ${o}: ${l.description}`);try{const c=await l.up();s.migrations.push({version:o,description:l.description,result:c}),c.success||s.errors.push(`Migration ${o}: ${c.error}`)}catch(c){const u=`Migration ${o} failed: ${c.message}`;s.errors.push(u),console.error(u,c)}}localStorage.setItem(y.STORAGE_KEYS.SCHEMA_VERSION,t),s.errors.length===0&&localStorage.removeItem(a),s.success=s.errors.length===0,s.message=s.success?`עודכן בהצלחה מגרסה ${e} לגרסה ${t}`:`שגיאות בעדכון: ${s.errors.length}`}catch(a){s.success=!1,s.error=`שגיאה במעבר נתונים: ${a.message}`}return s}}class M{static async checkAllData(){const e={overall:!0,errors:[],warnings:[],stats:{transactions:0,categories:0,budgets:0,accounts:0,settings:0},details:{}};try{const t=await this.checkTransactions();e.details.transactions=t,e.stats.transactions=t.count,t.valid||(e.overall=!1,e.errors.push(...t.errors)),e.warnings.push(...t.warnings);const s=await this.checkCategories();e.details.categories=s,e.stats.categories=s.count,s.valid||(e.overall=!1,e.errors.push(...s.errors)),e.warnings.push(...s.warnings);const a=await this.checkBudgets();e.details.budgets=a,e.stats.budgets=a.count,a.valid||(e.overall=!1,e.errors.push(...a.errors)),e.warnings.push(...a.warnings);const n=await this.checkAccounts();e.details.accounts=n,e.stats.accounts=n.count,n.valid||(e.overall=!1,e.errors.push(...n.errors)),e.warnings.push(...n.warnings);const i=await this.checkReferences();e.details.references=i,i.valid||(e.overall=!1,e.errors.push(...i.errors)),e.warnings.push(...i.warnings)}catch(t){e.overall=!1,e.errors.push(`שגיאה בבדיקת שלמות נתונים: ${t.message}`)}return e}static async checkTransactions(){const e=d.transactions.getAll(),t=[],s=[];let a=0;return e.forEach((n,i)=>{try{const o=v.validateTransaction(n);v.hasErrors(o)?t.push(`עסקה ${i+1}: ${v.getErrorMessages(o).join(", ")}`):a++,Math.abs(n.סכום)>1e6&&s.push(`עסקה ${i+1}: סכום חריג - ${n.סכום}`),new Date(n.תאריך)>new Date&&s.push(`עסקה ${i+1}: תאריך בעתיד - ${n.תאריך}`)}catch(o){t.push(`עסקה ${i+1}: שגיאה בבדיקה - ${o.message}`)}}),{valid:t.length===0,count:e.length,validCount:a,errors:t,warnings:s}}static async checkCategories(){const e=d.categories.getAll(),t=[],s=[];let a=0;const n={};return e.forEach((i,o)=>{try{const l=v.validateCategory(i);v.hasErrors(l)?t.push(`קטגוריה ${o+1}: ${v.getErrorMessages(l).join(", ")}`):a++,n[i.שם]?s.push(`קטגוריה כפולה: ${i.שם}`):n[i.שם]=!0}catch(l){t.push(`קטגוריה ${o+1}: שגיאה בבדיקה - ${l.message}`)}}),{valid:t.length===0,count:e.length,validCount:a,errors:t,warnings:s}}static async checkBudgets(){const e=d.budgets.getAll(),t=[],s=[];let a=0;return e.forEach((n,i)=>{try{const o=v.validateBudget(n);v.hasErrors(o)?t.push(`תקציב ${i+1}: ${v.getErrorMessages(o).join(", ")}`):a++,new Date(n.תקופה.end)<new Date&&n.אקטיבי&&s.push(`תקציב ${n.שם}: פג תוקף אך עדיין פעיל`)}catch(o){t.push(`תקציב ${i+1}: שגיאה בבדיקה - ${o.message}`)}}),{valid:t.length===0,count:e.length,validCount:a,errors:t,warnings:s}}static async checkAccounts(){const e=d.accounts.getAll(),t=[],s=[];let a=0;const n={};return e.forEach((i,o)=>{try{const l=v.validateAccount(i);v.hasErrors(l)?t.push(`חשבון ${o+1}: ${v.getErrorMessages(l).join(", ")}`):a++,i.מספר_חשבון&&n[i.מספר_חשבון]?s.push(`מספר חשבון כפול: ${i.מספר_חשבון}`):i.מספר_חשבון&&(n[i.מספר_חשבון]=!0),i.יתרה<-1e3&&i.סוג!=="אשראי"&&s.push(`חשבון ${i.שם}: יתרה שלילית גבוהה`)}catch(l){t.push(`חשבון ${o+1}: שגיאה בבדיקה - ${l.message}`)}}),{valid:t.length===0,count:e.length,validCount:a,errors:t,warnings:s}}static async checkReferences(){const e=d.transactions.getAll(),t=d.categories.getAll(),s=d.accounts.getAll(),a=new Set(t.map(u=>u.id)),n=new Set(s.map(u=>u.id)),i=[],o=[];e.forEach((u,h)=>{u.קטגוריה&&!a.has(u.קטגוריה)&&i.push(`עסקה ${h+1}: קטגוריה לא קיימת - ${u.קטגוריה}`),u.חשבון&&!n.has(u.חשבון)&&i.push(`עסקה ${h+1}: חשבון לא קיים - ${u.חשבון}`)});const l=new Set(e.map(u=>u.קטגוריה));t.forEach(u=>{l.has(u.id)||o.push(`קטגוריה לא בשימוש: ${u.שם}`)});const c=new Set(e.map(u=>u.חשבון));return s.forEach(u=>{c.has(u.id)||o.push(`חשבון לא בשימוש: ${u.שם}`)}),{valid:i.length===0,errors:i,warnings:o}}static async autoRepair(){const e={repaired:[],couldNotRepair:[]};try{const t=d.transactions.getAll(),s=d.categories.getAll(),a=d.accounts.getAll(),n=new Set(s.map(u=>u.id)),i=new Set(a.map(u=>u.id));let o=0;t.forEach(u=>{if(u.קטגוריה&&!n.has(u.קטגוריה)||u.חשבון&&!i.has(u.חשבון))try{d.transactions.delete(u.id),o++}catch{e.couldNotRepair.push(`לא ניתן למחוק עסקה יתומה: ${u.id}`)}}),o>0&&e.repaired.push(`נמחקו ${o} עסקאות יתומות`);const l=d.budgets.getAll();let c=0;l.forEach(u=>{if(new Date(u.תקופה.end)<new Date&&u.אקטיבי)try{d.budgets.update(u.id,{אקטיבי:!1}),c++}catch{e.couldNotRepair.push(`לא ניתן לכבות תקציב פג תוקף: ${u.שם}`)}}),c>0&&e.repaired.push(`כובו ${c} תקציבים שפג תוקפם`)}catch(t){e.couldNotRepair.push(`שגיאה כללית בתיקון: ${t.message}`)}return e}}const b={needsMigration:()=>B.needsMigration(),getCurrentVersion:()=>B.getCurrentVersion(),getTargetVersion:()=>B.getTargetVersion(),runMigrations:()=>B.runMigrations(),checkIntegrity:()=>M.checkAllData(),checkTransactions:()=>M.checkTransactions(),checkCategories:()=>M.checkCategories(),checkBudgets:()=>M.checkBudgets(),checkAccounts:()=>M.checkAccounts(),checkReferences:()=>M.checkReferences(),autoRepair:()=>M.autoRepair()};class Be{constructor(){this.initialized=!1,this.initPromise=null}async initialize(){return this.initialized?{success:!0,message:"מערכת נתונים כבר מאותחלת"}:this.initPromise?this.initPromise:(this.initPromise=this._doInitialization(),this.initPromise)}async _doInitialization(){try{if(console.log("Initializing Israeli Finance Data System..."),b.needsMigration()){console.log("Running data migrations...");const s=await b.runMigrations();if(!s.success)throw new Error(`Migration failed: ${s.error}`)}const e=await b.checkIntegrity();if(!e.overall){console.warn("Data integrity issues found:",e.errors);const s=await b.autoRepair();console.log("Auto-repair results:",s)}if(!d.utils.isAvailable())throw new Error("localStorage not available");const t=d.utils.getStats();return console.log("Data system stats:",t),this.initialized=!0,{success:!0,message:"מערכת נתונים אותחלה בהצלחה",stats:t,version:b.getCurrentVersion(),encryptionEnabled:L.isEnabled()}}catch(e){return console.error("Data system initialization failed:",e),{success:!1,error:`שגיאה באתחול מערכת נתונים: ${e.message}`}}}getStatus(){return{initialized:this.initialized,version:b.getCurrentVersion(),targetVersion:b.getTargetVersion(),needsMigration:b.needsMigration(),encryptionEnabled:L.isEnabled(),storageAvailable:d.utils.isAvailable(),stats:d.utils.getStats()}}}const ae=new Be,m={system:{initialize:()=>ae.initialize(),getStatus:()=>ae.getStatus(),clearAll:()=>d.utils.clearAll(),getStats:()=>d.utils.getStats()},transactions:d.transactions,categories:d.categories,budgets:d.budgets,accounts:d.accounts,settings:d.settings,templates:d.templates,validation:{validate:v,messages:g,validateTransaction:r=>v.validateTransaction(r),validateCategory:r=>v.validateCategory(r),validateBudget:r=>v.validateBudget(r),validateAccount:r=>v.validateAccount(r),hasErrors:r=>v.hasErrors(r),getErrorMessages:r=>v.getErrorMessages(r)},search:q.search,filter:q.filter,analytics:q.analytics,backup:{export:_.exportAll,exportTransactions:_.exportTransactions,exportCategories:_.exportCategories,exportForBank:_.exportForBank,import:_.importBackup,importTransactions:_.importTransactions,download:_.download,supportedFormats:_.supportedFormats},encryption:{isEnabled:L.isEnabled,enable:L.enable,disable:L.disable,getStatus:L.getStatus,updateSetting:L.updateSetting},migration:{needsMigration:b.needsMigration,getCurrentVersion:b.getCurrentVersion,getTargetVersion:b.getTargetVersion,runMigrations:b.runMigrations,checkIntegrity:b.checkIntegrity,autoRepair:b.autoRepair},utils:{formatters:w,createTransaction:r=>f.createTransaction(r),createCategory:r=>f.createCategory(r),createBudget:r=>f.createBudget(r),createAccount:r=>f.createAccount(r),createSettings:r=>f.createSettings(r),createDefaultCategories:()=>f.createDefaultCategories(),createDefaultAccount:()=>f.createDefaultAccount(),normalizeHebrew:q.utils.normalizeHebrew},schema:y,defaultCategories:V,israeliBanks:ce};m.system.initialize().then(r=>{r.success?(console.log("✅ Israeli Finance Data System initialized successfully"),console.log(`📊 Version: ${r.version}`),console.log(`🔒 Encryption: ${r.encryptionEnabled?"Enabled":"Disabled"}`),console.log("📈 Stats:",r.stats)):console.error("❌ Data system initialization failed:",r.error)});const le={getTransactions:()=>m.transactions.getAll(),addTransaction:r=>m.transactions.save(r),updateTransaction:(r,e)=>m.transactions.update(r,e),deleteTransaction:r=>m.transactions.delete(r),searchTransactions:r=>m.search.transactions(r),getCategories:()=>m.categories.getAll(),addCategory:r=>m.categories.save(r),updateCategory:(r,e)=>m.categories.update(r,e),deleteCategory:r=>m.categories.delete(r),getAccounts:()=>m.accounts.getAll(),addAccount:r=>m.accounts.save(r),updateAccount:(r,e)=>m.accounts.update(r,e),deleteAccount:r=>m.accounts.delete(r),getTransactionTemplates:()=>m.templates.getAll(),saveTransactionTemplate:r=>m.templates.save(r),updateTransactionTemplate:(r,e)=>m.templates.update(r,e),deleteTransactionTemplate:r=>m.templates.delete(r),getTemplatesByType:r=>m.templates.getByType(r),exportTransactions:(r,e)=>m.backup.exportTransactions(r,e),validateTransaction:r=>m.validation.validateTransaction(r),validateCategory:r=>m.validation.validateCategory(r)},F=Object.freeze(Object.defineProperty({__proto__:null,DATA_SCHEMA:y,DEFAULT_CATEGORIES:V,DataAPI:m,DataBackup:_,DataManager:le,DataValidator:v,EncryptionAPI:L,ISRAELI_BANKS:ce,MigrationAPI:b,ModelFactory:f,SearchAPI:q,StorageAPI:d,formatters:w},Symbol.toStringTag,{value:"Module"}));console.log("🏦 Israeli Finance Dashboard - Starting up...");window.IsraeliSalaryCalculator=G;window.HEBREW_FINANCIAL_TERMS=ne;window.ISRAELI_FINANCIAL_TIPS=ie;window.ThemeToggle=x;window.TransactionForm=U;window.CategoryManager=R;window.DataAPI=m;window.DataManager=le;document.addEventListener("DOMContentLoaded",()=>{Pe()});async function Pe(){console.log("📦 ES6 modules loaded via static imports"),await Ve(),setTimeout(()=>{const r=document.getElementById("loading"),e=document.getElementById("app");r&&(r.style.display="none"),e&&(e.style.display="block"),console.log("✅ App initialized successfully")},1e3),de(),Ye(),Ke(),ze(),Xe()}async function Ve(){const r=["./src/utils/israeli-formatting.js","./src/components/Button.js","./src/components/Input.js","./src/components/Navigation.js","./src/components/Modal.js","./src/components/Toast.js","./src/components/Dashboard.js","./src/components/TransactionList.js","./src/components/Charts.js"];try{for(const s of r)await He(s);console.log("📦 Hebrew UI Components loaded successfully"),console.log("💾 Data Management System loaded successfully");const t=["Button","Toast","Modal"].filter(s=>!window[s]);t.length>0&&console.warn("⚠️ Some critical components are missing:",t)}catch(e){console.error("❌ Error loading components:",e),typeof HebrewToasts<"u"?HebrewToasts.error("שגיאה בטעינת רכיבי ממשק המשתמש"):(console.error("Toast system not available - using basic alert"),alert("שגיאה בטעינת רכיבי ממשק המשתמש - חלק מהפונקציות עלולות להיות לא זמינות"))}}function He(r){return new Promise((e,t)=>{const s=document.createElement("script");s.src=r,s.onload=()=>{console.log(`📦 Script loaded: ${r}`),e()},s.onerror=a=>{console.error(`❌ Failed to load script: ${r}`,a),(r.includes("Button")||r.includes("Toast")||r.includes("Modal"))&&console.warn(`⚠️ Critical UI component ${r} failed to load - some UI features may be unavailable`),e()},document.head.appendChild(s)})}function de(){window.startApp=function(){console.log("🚀 Starting main application..."),window.ComponentUtils?Y():HebrewToasts!=null&&HebrewToasts.info("מערכת הרכיבים עדיין נטענת...")||alert("ברוכים הבאים! המערכת תהיה זמינה בקרוב.")},document.querySelectorAll(".nav a").forEach(r=>{r.addEventListener("click",e=>{e.preventDefault();const t=e.target.getAttribute("href").substring(1);console.log(`Navigating to: ${t}`),window.HebrewToasts&&HebrewToasts.info(`ניווט אל: ${je(t)}`)})})}function je(r){return{dashboard:"לוח בקרה",transactions:"עסקאות",budget:"תקציב",reports:"דוחות",settings:"הגדרות"}[r]||r}function Y(){const r=ComponentUtils.createDemo(),e=document.querySelector(".main");if(e){const t=e.innerHTML,s=new Button({type:"secondary",icon:"←"}).render("חזור לדף הבית",()=>{e.innerHTML=t,de(),HebrewToasts.info("חזרת לדף הבית")});r.insertBefore(s,r.firstChild),e.innerHTML="",e.appendChild(r),HebrewToasts.success("ברוכים הבאים למערכת הרכיבים החדשה!","מערכת רכיבים")}}function ze(){typeof HebrewNavigation<"u"&&(console.log("🎨 UI Components ready"),(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&Ue(),Ge(),setTimeout(()=>{window.HebrewToasts&&HebrewToasts.info("מערכת הרכיבים הישראלית מוכנה לשימוש!","מוכן")},2e3))}function Ue(){const r=document.querySelector(".header-content");if(r&&window.Button){const e=new Button({type:"secondary",size:"sm",style:{marginRight:"1rem",backgroundColor:"rgba(255, 255, 255, 0.2)",color:"white",border:"1px solid rgba(255, 255, 255, 0.3)"}}).render("🧪 Demo",()=>{window.ComponentUtils&&Y()});r.appendChild(e)}}function Ge(){document.addEventListener("keydown",r=>{(r.ctrlKey||r.metaKey)&&r.key==="d"&&(r.preventDefault(),window.ComponentUtils&&Y()),r.key==="Escape"&&document.querySelectorAll(".modal.show").forEach(e=>{e.close&&e.close()})})}function Ye(){if(typeof IsraeliFormatter<"u"){console.log("🔤 Enhanced Hebrew formatting initialized"),window.israeliFormatter=new IsraeliFormatter,console.log("✅ Israeli Formatter loaded successfully"),console.log("Currency test (basic):",window.israeliFormatter.formatCurrency(1234.56)),console.log("Currency test (compact):",window.israeliFormatter.formatCurrency(15e5,{compact:!0})),console.log("Currency test (no symbol):",window.israeliFormatter.formatCurrency(999.99,{showSymbol:!1})),console.log("Number test (basic):",window.israeliFormatter.formatNumber(1234567)),console.log("Number test (compact):",window.israeliFormatter.formatNumber(25e5,{compact:!0})),console.log("Date test (medium):",window.israeliFormatter.formatDate(new Date,"medium")),console.log("Date test (long):",window.israeliFormatter.formatDate(new Date,"long")),console.log("Tax year test:",window.israeliFormatter.getTaxYear()),console.log("Phone test:",window.israeliFormatter.formatPhone("0523456789")),console.log("ID test:",window.israeliFormatter.formatIsraeliID("123456789")),console.log("Percentage test:",window.israeliFormatter.formatPercentage(.155));const r=window.israeliFormatter.getCurrentTaxYearInfo();console.log("📅 Current tax year:",r.displayName),console.log("📅 Tax year period:",r.period)}}function Ke(){setTimeout(()=>{window.DataAPI?console.log("💾 DataAPI loaded successfully - checking stored data..."):console.log("⏳ DataAPI not loaded yet - will check data later")},1e3)}function Xe(){if(typeof x<"u"){console.log("🎨 Initializing theme system...");const r=new x({showLabel:!0,position:"top-right"}),e=document.querySelector(".header-content");if(e){const s=document.createElement("div");s.className="theme-toggle-container",s.style.marginLeft="var(--spacing-md)",s.innerHTML=r.getHTML(),e.appendChild(s);const a=s.querySelector(".theme-toggle");a&&a.addEventListener("click",()=>{r.toggleTheme()})}else document.body.appendChild(r.render()),r.toggleButton.classList.add("theme-toggle-fixed","theme-toggle-top-right");document.addEventListener("themeChanged",s=>{if(console.log("🌓 Theme changed to:",s.detail.theme),window.HebrewToasts){const a=s.detail.theme==="dark"?"עברת למצב לילה":"עברת למצב יום";HebrewToasts.info(a,"שינוי נושא")}});const t=localStorage.getItem("theme")||"light";document.documentElement.setAttribute("data-theme",t),console.log("✅ Theme system initialized")}else console.warn("⚠️ ThemeToggle component not loaded")}window.addEventListener("error",r=>{console.error("Application error:",r.error)});"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./sw.js").then(r=>{console.log("SW registered: ",r)}).catch(r=>{console.log("SW registration failed: ",r)})});console.log("🏁 Main.js loaded successfully");
//# sourceMappingURL=index-oTqquyTL.js.map
